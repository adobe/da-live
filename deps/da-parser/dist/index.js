import{Schema as H}from"../../da-y-wrapper/dist/index.js";import{addListNodes as te}from"../../da-y-wrapper/dist/index.js";import{tableNodes as re}from"../../da-y-wrapper/dist/index.js";function P(e){return[{tag:e,contentElement:t=>t}]}var y={dataId:{default:null,validate:"string|null"},daDiffAdded:{default:null,validate:"string|null"}},D=e=>{let t={};return e.attrs.dataId!=null&&(t["data-id"]=e.attrs.dataId),e.attrs.daDiffAdded===""&&(t["da-diff-added"]=""),t},M=e=>({dataId:e.getAttribute("dataId")??null,daDiffAdded:e.getAttribute("da-diff-added")??null}),N=e=>t=>({level:e,...M(t)}),ne={doc:{content:"block+"},paragraph:{attrs:{...y},content:"inline*",group:"block",parseDOM:[{tag:"p",getAttrs:M}],toDOM(e){return["p",{...D(e)},0]}},blockquote:{attrs:{...y},content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote",getAttrs:M}],toDOM(e){return["blockquote",{...D(e)},0]}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM(){return["hr"]}},heading:{attrs:{level:{default:1},...y},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",getAttrs:N(1)},{tag:"h2",getAttrs:N(2)},{tag:"h3",getAttrs:N(3)},{tag:"h4",getAttrs:N(4)},{tag:"h5",getAttrs:N(5)},{tag:"h6",getAttrs:N(6)}],toDOM(e){return[`h${e.attrs.level}`,{...D(e)},0]}},code_block:{attrs:{...y},content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs:M}],toDOM(e){return["pre",{...D(e)},["code",0]]}},text:{group:"inline"},image:{inline:!0,attrs:{src:{validate:"string"},alt:{default:null,validate:"string|null"},title:{default:null,validate:"string|null"},href:{default:null,validate:"string|null"},dataFocalX:{default:null,validate:"string|null"},dataFocalY:{default:null,validate:"string|null"},...y},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs(e){let t={src:e.getAttribute("src"),alt:e.getAttribute("alt"),href:e.getAttribute("href"),dataFocalX:e.getAttribute("data-focal-x"),dataFocalY:e.getAttribute("data-focal-y"),...M(e)},n=e.getAttribute("title");return n?.includes("data-focal:")||(t.title=n),t}}],toDOM(e){let{src:t,alt:n,title:r,href:a,dataFocalX:s,dataFocalY:i}=e.attrs,o={src:t,alt:n,title:r,href:a,...D(e)};return s!=null&&(o["data-focal-x"]=s),i!=null&&(o["data-focal-y"]=i),s!=null&&(o.title=`data-focal:${s},${i}`),["img",o]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM(){return["br"]}},loc_added:{group:"block",content:"block+",atom:!0,isolating:!0,parseDOM:P("da-loc-added"),toDOM:()=>["da-loc-added",{contenteditable:!1},0]},diff_added:{group:"block",content:"block+",atom:!0,isolating:!0,parseDOM:[{tag:"da-diff-added",contentElement:e=>([...e.children].forEach(t=>{t.properties&&(t.properties["da-diff-added"]="")}),e)}],toDOM:()=>["da-diff-added",{contenteditable:!1},0]},loc_deleted:{group:"block",content:"block+",atom:!0,isolating:!0,parseDOM:P("da-loc-deleted"),toDOM:()=>["da-loc-deleted",{contenteditable:!1},0]},diff_deleted:{group:"block",content:"block+",atom:!0,isolating:!0,parseDOM:[{tag:"da-diff-deleted",contentElement:e=>e}],toDOM:()=>["da-diff-deleted",{"data-mdast":"ignore",contenteditable:!1},0]}},ae={link:{attrs:{href:{},title:{default:null},...y},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs(e){return{href:e.getAttribute("href"),title:e.getAttribute("title"),...M(e)}}}],toDOM(e){let{href:t,title:n}=e.attrs;return["a",{href:t,title:n,...D(e)},0]}},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"},{style:"font-style=normal",clearMark:e=>e.type.name==="em"}],toDOM(){return["em",0]}},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:e=>e.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:e=>e.type.name==="strong"},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],toDOM(){return["strong",0]}},code:{parseDOM:[{tag:"code"}],toDOM(){return["code",0]}},s:{parseDOM:[{tag:"s"}],toDOM(){return["s",0]}},u:{parseDOM:[{tag:"u"}],toDOM(){return["u",0]}}},Y=new H({nodes:ne,marks:ae});function se(e){let t={parseDOM:[{tag:"sup"},{clearMark:a=>a.type.name==="sup"}],toDOM(){return["sup",0]}},n={parseDOM:[{tag:"sub"},{clearMark:a=>a.type.name==="sub"}],toDOM(){return["sub",0]}},r={toDOM:()=>["span",{class:"highlighted-context"},0]};return e.addToEnd("sup",t).addToEnd("sub",n).addToEnd("contextHighlightingMark",r)}function ie(){let e=re({tableGroup:"block",cellContent:"block+"});return e.table.attrs={...y},e.table.parseDOM=[{tag:"table",getAttrs:M}],e.table.toDOM=t=>["table",t.attrs,["tbody",0]],e}function F(e,t,n){let r=e;r.get(t).attrs={...y},r.get(t).parseDOM=[{tag:n,getAttrs:M}],r.get(t).toDOM=a=>[n,{...D(a)},0]}function oe(e){let t=te(e,"block+","block");return F(t,"bullet_list","ul"),F(t,"ordered_list","ol"),t}function O(){let{nodes:e}=Y.spec,{marks:t}=Y.spec;e=oe(e),e=e.update("diff_deleted",{...e.get("diff_deleted"),content:"(block | list_item)+"}),e=e.update("diff_added",{...e.get("diff_added"),content:"(block | list_item)+"}),e=e.update("loc_deleted",{...e.get("loc_deleted"),content:"(block | list_item)+"}),e=e.update("loc_added",{...e.get("loc_added"),content:"(block | list_item)+"}),e=e.append(ie());let n=se(t);return new H({nodes:e,marks:n})}var le=["div","p","hr","body","header","main","footer","em","strong","s","u","i","b","span","blockquote","picture","source","img","a","h1","h2","h3","h4","h5","h6","pre","code","img","br","ul","ol","li","table","thead","tbody","tr","td","th","sup","sub","da-loc-added","da-loc-deleted","da-diff-added","da-diff-deleted"];function A(e){return le.includes(e)}import{prosemirrorToYXmlFragment as de,yDocToProsemirror as ue}from"../../da-y-wrapper/dist/index.js";import{DOMParser as fe,DOMSerializer as k}from"../../da-y-wrapper/dist/index.js";var E;typeof DOMParser>"u"&&({fromHtml:E}=await import("hast-util-from-html"));function W(e,t){if(!t||t.type!=="element")return!1;let n=e.match(/^(\w+)\[(\w+)\]$/);if(n){let[,r,a]=n;return t.tagName===r&&t.properties?.[a]!=null}return t.tagName===e.toLowerCase()}function B(e){if(e.nodeType===3)return{type:"text",value:e.textContent};if(e.nodeType===8)return{type:"comment",value:e.textContent};if(e.nodeType===1){let t={};for(let r of e.attributes||[])if(r.name==="class")t.className=r.value.split(/\s+/).filter(Boolean);else if(r.name.startsWith("data-")){let a=r.name.replace(/-([a-z])/g,(s,i)=>i.toUpperCase());t[a]=r.value}else if(r.name==="colspan"||r.name==="rowspan"){let a=r.name==="colspan"?"colSpan":"rowSpan";t[a]=r.value}else t[r.name]=r.value;let n=[];for(let r of e.childNodes||[]){let a=B(r);a&&n.push(a)}return{type:"element",tagName:e.tagName.toLowerCase(),properties:t,children:n}}return null}function ce(e){let n=new DOMParser().parseFromString(`<body>${e}</body>`,"text/html"),{body:r}=n;return{type:"root",children:Array.from(r.childNodes).map(B).filter(Boolean)}}function J(e){return E?E(e,{fragment:!0}):ce(e)}function pe(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")}function R(e){e&&(e.children&&e.children.forEach(R),e.tagName==="p"&&e.children&&e.children.length===1&&e.children[0].type==="text"&&e.children[0].value==="---"&&(e.children.length=0,e.tagName="hr"))}function X(e){return e.children.filter(t=>t.tagName==="div")}function z(e,t){t.push({type:"element",tagName:"p",children:[],properties:{}});let n=Array.from(e.properties.className),r=n.shift(),a=n.length>0?`${r} (${n.join(", ")})`:r,s=[...X(e)],i=s.reduce((l,p)=>{let h=X(p);return h.length>l?h.length:l},0),o={type:"element",tagName:"table",children:[],properties:{}};o.properties.dataId=e.properties.dataId,o.properties["da-diff-added"]=e.properties["da-diff-added"],t.push(o);let u={type:"element",tagName:"tr",children:[],properties:{}},f={type:"element",tagName:"td",children:[{type:"text",value:a}],properties:{colSpan:i}};u.children.push(f),o.children.push(u),s.filter(l=>l.tagName==="div").forEach(l=>{let p={type:"element",tagName:"tr",children:[],properties:{}},h=(l.children?[...l.children]:[l]).filter(d=>d.type!=="text"||d.value&&d.value.trim()!==`
`&&d.value.trim()!=="");h.forEach((d,b)=>{let c={type:"element",tagName:"td",children:[],properties:{}};h.length<i&&b===h.length-1&&(c.properties.colSpan=i-b),c.children.push(h[b]),p.children.push(c)}),o.children.push(p)}),t.push({type:"element",tagName:"p",children:[],properties:{}})}function G(e){if(!e)return e;if(e.children){let t=[];if(e.children.forEach((n,r)=>{if(n.tagName==="a"&&n.children?.length>0){let{href:a,title:s,"da-diff-added":i}=n.properties,o=!1,u={href:a,title:s,...i===""?{"da-diff-added":i}:{}};n.children.forEach(f=>{f.tagName==="picture"?(o=!0,f.children.forEach(l=>{l.tagName==="img"&&(l.properties={...l.properties,...u})})):f.tagName==="img"&&(o=!0,f.properties={...f.properties,...u})}),o&&t.push({index:r,children:n.children})}else G(n)}),t.length>0){let n=[],r=0;e.children.forEach((a,s)=>{r<t.length&&t[r].index===s?(n.push(...t[r].children),r+=1):n.push(a)}),e.children=n}}return e}function q(e){return e&&(e.children=e.children?.filter(t=>t.type!=="comment")||[],e.children.forEach(q),e)}var K="<body><header></header><main><div></div></main><footer></footer></body>";function he(e){return e=e.replaceAll("<da-loc-added","<da-diff-added").replaceAll("<da-loc-deleted","<da-diff-deleted").replaceAll("</da-loc-added","</da-diff-added").replaceAll("</da-loc-deleted","</da-diff-deleted"),e}var T=e=>({type:"element",tagName:"da-diff-added",properties:{},children:e}),me=e=>e.type==="element"&&e.properties?.["da-diff-added"]!==void 0,ge=e=>e.tagName==="div"&&e.properties?.className?.includes("block-group-start"),be=e=>e.tagName==="div"&&e.properties?.className?.includes("block-group-end"),ye=(e,t)=>{let n=e.findIndex((r,a)=>a>t&&be(r));return{elementsToWrap:e.slice(t,n===-1?e.length:n+1),endIndex:n===-1?e.length-1:n}};function Me(e){if(!e?.children)return e;let t=[],n=!1;return e.children.forEach(r=>{if(r.tagName==="da-diff-deleted"&&r.children[0]?.tagName==="li"){n=!0;let a=r.children[0];delete r.properties["data-mdast"],delete r.properties.contenteditable,a.children=[{type:"element",tagName:"da-diff-deleted",properties:r.properties,children:a.children}],t.push(a)}else t.push(r)}),n&&(e.children=t),e}function ve(e){return e?.children&&e.children.forEach(t=>{t.tagName==="li"&&t.properties?.["da-diff-added"]!==void 0&&(delete t.properties["da-diff-added"],t.children=[T(t.children)])}),e}function De(e){e?.children&&e.children.forEach(t=>{if(t.tagName!=="div"||!t.children)return;let n=[...t.children],r=[];for(let a=0;a<n.length;a+=1){let s=n[a];if(me(s))if(ge(s)){let{elementsToWrap:i,endIndex:o}=ye(n,a);r.push(T(i)),a=o}else r.push(T([s]));else s.tagName==="ul"||s.tagName==="ol"?r.push(ve(Me(s))):r.push(s)}t.children=r})}var Ne=e=>{let t={};return e?.children&&e.children.forEach(n=>{if(n.tagName==="div"){let r=n.children?.filter(a=>a.tagName==="div")||[];if(r.length===2){let a=r[0].children?.[0]?.value,s=r[1].children?.[0]?.value||null;a&&(t[a]=s)}}}),t},w=e=>Object.entries(e).map(([t,n])=>` ${t}="${n}"`).join("");function U(e,t){if(!e)return e;if(e.type==="element"&&!A(e.tagName)){let n={type:"text",value:`<${e.tagName}${w(e.properties)}>`},r=t.children.indexOf(e);r>=0&&(t.children.splice(r,1,n),t.children.push(...e.children))}return e.children&&[...e.children].forEach(r=>U(r,e)),e}function Oe(e,t){e||(e=K),(e.includes("<da-loc-added")||e.includes("<da-loc-deleted"))&&(e=he(e));let n=J(e),r=n.children.find(l=>l.tagName==="div"&&l.properties?.className?.includes("da-metadata")),a=Ne(r),s=n.children.find(l=>l.tagName==="main");if(s){(e.includes("da-diff-added")||e.includes("da-diff-deleted"))&&De(s),G(s),q(s),U(s),(s.children||[]).forEach(h=>{if(h.tagName==="div"&&h.children){let d=[],b=!1;h.children.forEach(c=>{if(c.tagName==="div"&&c.properties.className?.length>0)b=!0,z(c,d);else if(["da-diff-deleted","da-diff-added"].includes(c.tagName)){b=!0;let m=[];c.children.forEach(g=>{g.tagName==="div"&&g.properties.className?.length>0?z(g,m):m.push(g)}),h.children=d,c.children=m,d.push(c)}else d.push(c)}),b&&(h.children=d)}}),R(s);let l=0,p=h=>({type:"element",tagName:h,children:[],properties:{}});s.children=s.children.flatMap(h=>{let d=[];return h.tagName==="div"?(l>0?(d.push(p("p")),d.push(p("hr")),d.push(p("p")),d.push(...h.children)):d.push(h),l+=1):d.push(h),d})}let i={get(l,p){let h=l;if(p==="firstChild"){if(l.children.length===0)return null;for(let d=0;d<l.children.length-1;d+=1)h.children[d].nextSibling=new Proxy(l.children[d+1],i),d>0?h.children[d].previousSibling=new Proxy(l.children[d-1],i):h.children[d].previousSibling=new Proxy(l.children[l.children.length-1],i);return new Proxy(l.children[0],i)}return p==="nodeType"?l.type==="text"?3:1:p==="nodeValue"?l.value:p==="nextSibling"?l.nextSibling:p==="previousSibling"?l.previousSibling:p==="nodeName"?l.tagName?.toUpperCase():p==="matches"?d=>W(d,l):p==="getAttribute"?d=>(d==="colspan"&&(d="colSpan"),d==="rowspan"&&(d="rowSpan"),l.properties?l.properties[d]:void 0):p==="hasAttribute"?d=>l.properties&&l.properties[d]:p==="style"?{}:Reflect.get(l,p)}},o=O(),u=fe.fromSchema(o).parse(new Proxy(s||n,i)),f=t.getMap("daMetadata");Object.entries(a).forEach(([l,p])=>{p!==null?f.set(l,p):f.delete(l)}),de(u,t.getXmlFragment("prosemirror"))}function _(e){let{attributes:t}=e,n=w(t);if(!e.children||e.children.length===0){if(e.type==="text")return pe(e.text);if(e.type==="p")return"";if(e.type==="img"){t.loading||(n+=' loading="lazy"');let{href:s,src:i,title:o}=t;if(t.href){delete t.href,delete t.title;let u=t["da-diff-added"]===""?' da-diff-added=""':"";delete t["da-diff-added"],n=w(t);let f=o?` title="${o}"`:"";return`<a href="${s}"${f}${u}><picture><source srcset="${i}"><source srcset="${i}" media="(min-width: 600px)"><img${n}></picture></a>`}return`<picture><source srcset="${i}"><source srcset="${i}" media="(min-width: 600px)"><img${n}></picture>`}return e.type!=="br"?`<${e.type}${n}></${e.type}>`:`<${e.type}>`}let{children:r}=e;return e.type==="li"&&r.length===1&&r[0].type==="p"&&(r=r[0].children),e.type==="p"&&r.length>0&&r.filter(s=>s.type!=="text"?!0:s.text?.trim().length>0).every(s=>s.type==="img")?r.map(s=>_(s)).join(""):`<${e.type}${n}>${r.map(a=>_(a)).join("")}</${e.type}>`}function Se(e){if(!e)return[];let t=[],n=e.lastIndexOf("(");return n>=0?(t.push(e.substring(0,n)),t.push(...e.substring(n+1).split(","))):t.push(e),t.map(r=>r.toLowerCase().replace(/[^0-9a-z]+/g,"-").replace(/^-+/,"").replace(/-+$/,"")).filter(r=>!!r)}function xe(e){if(!e?.children)return e;let t=[],n=!1;return e.children.forEach(r=>{if(r.type==="li"&&r.children[0]?.type==="da-diff-added")n=!0,r.attributes["da-diff-added"]="",r.children=r.children[0].children,r.children.forEach(a=>{a.attributes?.["da-diff-added"]!==void 0&&delete a.attributes["da-diff-added"]}),t.push(r);else if(r.type==="li"&&r.children[0]?.type==="da-diff-deleted"){n=!0;let a={type:"da-diff-deleted",attributes:{"data-mdast":"ignore"},children:[]},s=r.children[0];delete s.attributes.contenteditable,r.children=s.children,a.children.push(r),t.push(a)}else t.push(r)}),n&&(e.children=t),e}function S(e,t){let n=e.children[0].children,r=n.shift(),s={type:"div",attributes:{class:Se(r.children[0].children[0].children[0]?.text).join(" ")},children:[]},{dataId:i,daDiffAdded:o}=e.attributes||{};i&&(s.attributes["data-id"]=i),o===""&&(s.attributes["da-diff-added"]=""),t.children.push(s),n.forEach(u=>{let f={type:"div",attributes:{},children:[]};s.children.push(f),u.children.forEach(l=>{f.children.push({type:"div",attributes:{},children:l.children})})})}function Ae(e){let t=O(),n=ue(t,e),r=e.getMap("daMetadata"),a={};r.forEach((c,m)=>{a[m]=c}),n=n.type.create({...n.attrs,...a},n.content);let s={type:"div",children:[],attributes:{}},i={get(c,m){let g=c;return m==="createDocumentFragment"?()=>new Proxy(s,i):m==="appendChild"?v=>c.children.push(v):m==="createElement"?v=>new Proxy({type:v,children:[],attributes:[]},i):m==="createTextNode"?v=>new Proxy({type:"text",text:v,attributes:{}},i):m==="setAttribute"?(v,ee)=>{g.attributes[v]=ee}:Reflect.get(c,m)}},o=k.nodesFromSchema(t),u=k.marksFromSchema(t);delete u.contextHighlightingMark,new k(o,u).serializeFragment(n.content,{document:new Proxy({},i)});let{children:l}=s;s.children=[],l.forEach(c=>{if(c.type==="table")S(c,s);else if(c.type==="ul"||c.type==="ol"){let m=xe(c);s.children.push(m)}else if(c.type==="da-diff-deleted"||c.type==="da-loc-deleted"||c.type==="da-loc-added"){delete c.attributes.contenteditable;let m=c.children;c.children=[],m.forEach(g=>{g.type==="table"?S(g,c):c.children.push(g)}),s.children.push(c)}else c.type==="da-diff-added"?c.children.forEach(g=>{g.type==="table"?S(g,s):s.children.push(g)}):s.children.push(c)});let p={type:"div",attributes:{},children:[]},d=[...s.children].reduce((c,m)=>(m.type==="hr"?c.push({type:"div",attributes:{},children:[]}):c[c.length-1].children.push(m),c),[p]).map(c=>_(c)).join(""),b="";return Object.keys(a).length>0&&(b=`
  <div class="da-metadata">${Object.entries(a).map(([m,g])=>`<div><div>${m}</div><div>${g}</div></div>`).join("")}</div>`),`
<body>
  <header></header>
  <main>${d}</main>
  <footer></footer>${b}
</body>
`}import*as ke from"../../da-y-wrapper/dist/index.js";var x=20,I={minDimensions:[20,20],sheetName:"data"};function Ee(e){if(!e?.length)return[[],[]];let t=Object.keys(e[0]).map(r=>r),n=e.reduce((r,a)=>{let s=Object.keys(a).map(i=>a[i]);return r.push(s),r},[]);return[t,...n]}function $(e,t){let n=Ee(e.data),r={...I},[a,s]=r.minDimensions;for(;n.length<a;)n.push([]);for(let f=0;f<n.length;f+=1)for(;n[f].length<s;)n[f].push("");let i=Math.max(s,n[0]?.length||0),o=e[":colWidths"]||[],u=new Array(i).fill(null).map((f,l)=>({width:o[l]||"50"}));return{...r,sheetName:t,data:n,columns:u}}function V(e){let t=[];e[":type"]==="sheet"&&t.push($(e,e[":sheetname"]||"data"));let n=e[":names"];n&&n.forEach(a=>{t.push($(e[a],a))});let r=e[":private"];return r&&Object.keys(r).forEach(a=>{t.push($(r[a],a))}),t}function j(e){return ke}function Te(e,t,n=null){let r=n||j(t),a=new r.XmlElement("row"),s=Math.max(e.length,20),i=new Array(s);for(let o=0;o<s;o+=1){let u=new r.XmlElement("cell");u.setAttribute("value",String(e[o]??"")),i[o]=u}return a.insert(0,i),a}function Q(e,t,n,r=null){t.length>0&&t.delete(0,t.length);let a=Math.max(e?.length??0,20),s=new Array(a),i=r||j(n);for(let o=0;o<a;o+=1)s[o]=Te(e?.[o]??[],n,i);t.insert(0,s)}function L(e,t,n=!1,r=null){let a=t.getArray("sheets");n&&a.length>0&&a.delete(0,a.length);let s=r||j(t);return e.forEach(i=>{let o=new s.Map;o.set("sheetName",i.sheetName);let u=new s.Array;i.minDimensions&&u.push([i.minDimensions]),o.set("minDimensions",u);let f=new s.XmlFragment;Q(i.data,f,t,s),o.set("data",f);let l=new s.Array;i.columns&&i.columns.forEach(p=>{let h=new s.Map;Object.entries(p).forEach(([d,b])=>{h.set(d,b)}),l.push([h])}),o.set("columns",l),a.push([o])}),a}function we(e){let t=[];return e&&e.forEach(n=>{let r=[];n.forEach(a=>{let s=a.getAttribute("value")||"";r.push(s)}),t.push(r)}),t}function C(e,t=!0){let n=[];return e.forEach(r=>{let a={};a.sheetName=r.get("sheetName");let s=r.get("minDimensions");s?.length>0&&(a.minDimensions=s.toArray());let i=r.get("data");a.data=we(i);let o=r.get("columns");a.columns=[],o&&o.forEach(u=>{let f={};u.forEach((l,p)=>{f[p]=l}),t||(f.readOnly=!0),a.columns.push(f)}),t||delete a.minDimensions,n.push(a)}),n}function _e(e){let t=e.reduce((n,r,a)=>{if(a>0){let s={};r.forEach((i,o)=>{e[0][o]&&(s[e[0][o]]=i)}),n.push(s)}return n},[]);for(;t.length>1&&!Object.values(t.slice(-1)[0]).some(Boolean);)t.pop();return t}function Z(e){let t=o=>{let u=_e(o.data);return{total:u.length,limit:u.length,offset:0,data:u,":colWidths":o.columns.map(f=>f.width)}},{publicSheets:n,privateSheets:r}=e.reduce((o,u)=>(u.sheetName.startsWith("private-")?o.privateSheets[u.sheetName]=t(u):o.publicSheets[u.sheetName]=t(u),o),{publicSheets:{},privateSheets:{}}),a=Object.keys(n),s=Object.keys(r),i={};if(a.length>1)i=n,i[":names"]=a,i[":version"]=3,i[":type"]="multi-sheet";else if(a.length===1){let o=a[0];i=n[o],i[":sheetname"]=o,i[":type"]="sheet"}return s.length>0&&(i[":private"]=r),JSON.stringify(i)}var $e=[{...I}];function Ie(e,t){let n=Object.keys(e??{}).length===0?$e:e,r=V(n);return console.log("sheets",r),L(r,t)}function je(e){let t=e.getArray("sheets"),n=C(t);return Z(n)}import{prosemirrorToYXmlFragment as ct,yDocToProsemirror as dt}from"../../da-y-wrapper/dist/index.js";export{K as EMPTY_DOC,x as MIN_SHEET_DIMENSIONS,Oe as aem2doc,Q as dataArrayToY,Ae as doc2aem,je as doc2json,O as getSchema,A as isKnownHTMLTag,L as jSheetToY,Ie as json2doc,ct as prosemirrorToYXmlFragment,S as tableToBlock,dt as yDocToProsemirror,C as yToJSheet};
