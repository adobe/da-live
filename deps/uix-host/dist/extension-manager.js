var Ke=Object.create;var B=Object.defineProperty;var Be=Object.getOwnPropertyDescriptor;var qe=Object.getOwnPropertyNames;var Ve=Object.getPrototypeOf,Ye=Object.prototype.hasOwnProperty;var O=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Xe=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of qe(t))!Ye.call(e,s)&&s!==r&&B(e,s,{get:()=>t[s],enumerable:!(n=Be(t,s))||n.enumerable});return e};var Je=(e,t,r)=>(r=e!=null?Ke(Ve(e)):{},Xe(t||!e||!e.__esModule?B(r,"default",{value:e,enumerable:!0}):r,e));var k=O(y=>{"use strict";var Qe=Object.create,ne=Object.defineProperty,Ze=Object.getOwnPropertyDescriptor,se=Object.getOwnPropertyNames,et=Object.getPrototypeOf,tt=Object.prototype.hasOwnProperty,rt=(e,t)=>function(){return t||(0,e[se(e)[0]])((t={exports:{}}).exports,t),t.exports},nt=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of se(t))!tt.call(e,s)&&s!==r&&ne(e,s,{get:()=>t[s],enumerable:!(n=Ze(t,s))||n.enumerable});return e},st=(e,t,r)=>(r=e!=null?Qe(et(e)):{},nt(t||!e||!e.__esModule?ne(r,"default",{value:e,enumerable:!0}):r,e)),ot=rt({"../../node_modules/eventemitter3/index.js"(e,t){var r=Object.prototype.hasOwnProperty,n="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(n=!1));function o(u,l,d){this.fn=u,this.context=l,this.once=d||!1}function i(u,l,d,h,m){if(typeof d!="function")throw new TypeError("The listener must be a function");var v=new o(d,h||u,m),g=n?n+l:l;return u._events[g]?u._events[g].fn?u._events[g]=[u._events[g],v]:u._events[g].push(v):(u._events[g]=v,u._eventsCount++),u}function a(u,l){--u._eventsCount===0?u._events=new s:delete u._events[l]}function c(){this._events=new s,this._eventsCount=0}c.prototype.eventNames=function(){var l=[],d,h;if(this._eventsCount===0)return l;for(h in d=this._events)r.call(d,h)&&l.push(n?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(d)):l},c.prototype.listeners=function(l){var d=n?n+l:l,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var m=0,v=h.length,g=new Array(v);m<v;m++)g[m]=h[m].fn;return g},c.prototype.listenerCount=function(l){var d=n?n+l:l,h=this._events[d];return h?h.fn?1:h.length:0},c.prototype.emit=function(l,d,h,m,v,g){var b=n?n+l:l;if(!this._events[b])return!1;var f=this._events[b],E=arguments.length,x,p;if(f.fn){switch(f.once&&this.removeListener(l,f.fn,void 0,!0),E){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,d),!0;case 3:return f.fn.call(f.context,d,h),!0;case 4:return f.fn.call(f.context,d,h,m),!0;case 5:return f.fn.call(f.context,d,h,m,v),!0;case 6:return f.fn.call(f.context,d,h,m,v,g),!0}for(p=1,x=new Array(E-1);p<E;p++)x[p-1]=arguments[p];f.fn.apply(f.context,x)}else{var Ge=f.length,$;for(p=0;p<Ge;p++)switch(f[p].once&&this.removeListener(l,f[p].fn,void 0,!0),E){case 1:f[p].fn.call(f[p].context);break;case 2:f[p].fn.call(f[p].context,d);break;case 3:f[p].fn.call(f[p].context,d,h);break;case 4:f[p].fn.call(f[p].context,d,h,m);break;default:if(!x)for($=1,x=new Array(E-1);$<E;$++)x[$-1]=arguments[$];f[p].fn.apply(f[p].context,x)}}return!0},c.prototype.on=function(l,d,h){return i(this,l,d,h,!1)},c.prototype.once=function(l,d,h){return i(this,l,d,h,!0)},c.prototype.removeListener=function(l,d,h,m){var v=n?n+l:l;if(!this._events[v])return this;if(!d)return a(this,v),this;var g=this._events[v];if(g.fn)g.fn===d&&(!m||g.once)&&(!h||g.context===h)&&a(this,v);else{for(var b=0,f=[],E=g.length;b<E;b++)(g[b].fn!==d||m&&!g[b].once||h&&g[b].context!==h)&&f.push(g[b]);f.length?this._events[v]=f.length===1?f[0]:f:a(this,v)}return this},c.prototype.removeAllListeners=function(l){var d;return l?(d=n?n+l:l,this._events[d]&&a(this,d)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=n,c.EventEmitter=c,typeof t<"u"&&(t.exports=c)}}),it=()=>typeof window.matchMedia=="function"&&window.matchMedia("(prefers-color-scheme: dark)").matches,at={medium:{padX:5,padY:3,rounded:4,fontSize:100,emphasis:"font-weight: bold;"},small:{padX:3,padY:1,rounded:2,fontSize:95,emphasis:"font-style: italic;"}},ct={yellow:{text:"#333333",bg:"#EBD932",hilight:"#F7E434",shadow:"#D1C12C"},green:{text:"#333333",bg:"#96EB5E",hilight:"#9EF763",shadow:"#85D154"},blue:{text:"#333333",bg:"#8DD0EB",hilight:"#88F0F7",shadow:"#74AED4"},gray:it()?{text:"#eeeeee",bg:"transparent",hilight:"#cecece",shadow:"#cecece"}:{text:"#333333",bg:"#eeeeee",hilight:"#f6f6f6",shadow:"#cecece"}};function W(e){let t=new Map;return r=>{if(!t.has(r)){let n=e(r);return t.set(r,n),t.size>100&&t.delete(t.keys().next().value),n}return t.get(r)}}var oe=W(e=>{if(typeof e=="string"){let[t,r]=e.split(" ");return{...ct[t],...at[r]}}return e}),ut="display: inline-block; border: 1px solid;",q=e=>`padding-${e}: 0px; border-${e}-width: 0px; border-top-${e}-radius: 0px; border-bottom-${e}-radius: 0px;`,lt=({bg:e,hilight:t,shadow:r,text:n})=>`color: ${n}; background: ${e}; border-color: ${t} ${r} ${r} ${t};`,dt=({fontSize:e,padY:t,padX:r,rounded:n})=>`font-size: ${e}%; padding: ${t}px ${r}px; border-radius: ${n}px;`,ht=W(e=>{let t=`${ut}${lt(e)}${dt(e)}`;return[`${t}${q("right")}`,`${t}${q("left")}${e.emphasis}`]});function ie(e,t,r){let n=`%c${e}%c ${t}`,[s,o]=ht(r);return i=>{let a=[n,s,o];return typeof i[0]=="string"&&(a[0]=`${n}%c ${i.shift()}`,a.push("")),[...a,...i]}}var V={event:"\uFE0F\u26A1\uFE0F"},ft=" \u293B ",gt=W(e=>{let t=JSON.parse(e),r=t.shift(),n=V[r.type],s=[r.name,...t.map(o=>`${V[o.type]} ${o.name}`)].join(ft);return ie(n,s,oe("gray small"))}),Y=e=>gt(JSON.stringify(e)),X=["log","error","warn","info","debug"],J=e=>e,ae=()=>{};function ce(e,t,r){let n=ie(`X${t}`,r,oe(e)),s=J,o=[],i={detach:{writable:!0,configurable:!0,value(){X.forEach(c=>{this[c]=ae})}},pushState:{value(c){o.push(c),s=Y(o)}},popState:{value(){o.pop(),s=o.length===0?J:Y(o)}}};return Object.create(console,X.reduce((c,u)=>(c[u]={writable:!0,configurable:!0,value(...l){console[u](...n(s(l)))}},c),i))}var ue=new Proxy(console,{get(){return ae}});function pt(e,t){let r=ce(t.theme,t.type||Object.getPrototypeOf(e).constructor.name,t.id||e.id),n=e.dispatchEvent;e.dispatchEvent=a=>{r.pushState({type:"event",name:a.type});let c=n.call(e,a);return r.popState(),c};let s=[],o=r.detach;r.detach=()=>{o.call(r),s.forEach(a=>a())};function i(a,c){return s.push(e.addEventListener(a,u=>c(r,u))),r}return r.listen=i,r}var mt=class extends EventTarget{constructor(e){super(),this.id=e}emit(e,t){let r=new CustomEvent(e,{detail:t});this.dispatchEvent(r)}addEventListener(e,t){return super.addEventListener(e,t),()=>super.removeEventListener(e,t)}};function le(e,t=[]){let r={get:(o,i)=>{if(typeof i=="string"){if(!Reflect.has(o,i)){let a=le(e,t.concat(i));Reflect.set(o,i,a)}return Reflect.get(o,i)}else throw new Error(`Cannot look up a symbol ${String(i)} on a host connection proxy.`)}},n={};if(t.length<2)return new Proxy(n,r);let s=(...o)=>e({path:t.slice(0,-1),name:t[t.length-1],args:o});return new Proxy(s,{...r,apply(o,i,a){return o(...a)}})}var C="_$pg",M="1.0.1",vt=`${C}_init_cb`;function z(e){if(!e||typeof e!="object")return!1;let t=Reflect.getPrototypeOf(e);return t===null||t===Object.prototype}function j(e){if(!e)return!0;let t=typeof e;return t==="string"||t==="number"||t==="boolean"}function de(e){return Array.isArray(e)}function yt(e){return typeof e=="function"}function bt(e,t){return!j(e)&&Reflect.has(e,t)}function Et(e){if(!e||j(e))return!1;let{nodeName:t}=e;return typeof t=="string"&&t.toLowerCase()==="iframe"}function xt(e){return!e||typeof e!="object"?!1:Reflect.getPrototypeOf(e)!==Object.prototype}function I(e){return{[C]:e}}function _(e){return e[C]}function he(e){if(!z(e))return!1;let t=Object.keys(e),r=t.includes(C);return r&&t.length!=1?(console.error(`malformed tunnel message, should have one prop "${C}" at root`,e),!1):r}var U=Symbol.for("NOT_TRANSFORMED"),Q="[[Circular]]";function R(e,t,r,n=new WeakSet){if(j(t))return t;let s=e(t,r);if(s!==U)return s;if(de(t)){let o=[];for(let i of t)o.push(R(e,i,void 0,n));return o}if(z(t)){if(n.has(t))return Q;n.add(t);let o={};for(let i of Reflect.ownKeys(t))Reflect.set(o,i,R(e,Reflect.get(t,i),void 0,n));return o}if(xt(t)){if(n.has(t))return Q;n.add(t);let o=c=>{let u=new Set;do if(Reflect.getPrototypeOf(c)!==null)for(let l of Object.getOwnPropertyNames(c))l!=="constructor"&&u.add(l);while(c=Reflect.getPrototypeOf(c));return[...u]},i={},a=o(t);for(let c of a)Reflect.set(i,c,R(e,Reflect.get(t,c),t,n));return i}throw new Error(`Bad value! ${Object.prototype.toString.call(t)}`)}function fe(e,t,r){let n=async({fnId:s,callId:o,args:i})=>{try{let a=await e(...i);r.deref().respond({fnId:s,callId:o,value:a,status:"resolve"})}catch(a){r.deref().respond({fnId:s,callId:o,status:"reject",error:a})}};return r.deref().onCall(t,n)}var Z=class extends Error{constructor(){super("Function belongs to a simulated remote object which has been disconnected! The tunnel may have been destroyed by page navigation or reload.")}};function wt(e,t,r,n,s){e.onRespond(t,o=>{r.delete(s),o.status==="resolve"?n(o.value):s(o.error)}),e.send(t)}function Pt({fnId:e},t){let r=0,n=new Set,s=function(...a){return new Promise((c,u)=>{n.add(u);let l=++r,d={fnId:e,callId:l,args:a};return wt(t.deref(),d,n,c,u)})},o=()=>{t=null,s=()=>{throw new Z};for(let a of n)a(new Z);n.clear()};t.deref().onDestroyed(o);let i=async function(...a){return s(...a)};return Object.defineProperty(i,"name",{value:e}),i}var Ot=class{constructor(e,t){this.emitter=e,this.simulator=t}notifyCleanup(e){return this.emitter.emit(`${e.fnId}_g`,{})}notifyConnect(){return this.emitter.emit("connected")}notifyDestroy(){return this.emitter.emit("destroyed")}onCall(e,t){return this.subscribe(`${e.fnId}_c`,r=>t(this.processCallTicket(r,this.simulator.materialize)))}onConnected(e){return this.subscribe("connected",e)}onDestroyed(e){return this.subscribe("destroyed",e)}onOutOfScope(e,t){return this.subscribeOnce(`${e.fnId}_g`,t)}onRespond(e,t){let r=`${e.fnId}${e.callId}`;return this.subscribeOnce(`${r}_r`,n=>t(this.processResponseTicket(n,this.simulator.materialize)))}respond(e){let t=`${e.fnId}${e.callId}`;return this.emitter.emit(`${t}_r`,this.processResponseTicket(e,this.simulator.simulate))}send(e){return this.emitter.emit(`${e.fnId}_c`,this.processCallTicket(e,this.simulator.simulate))}processCallTicket({args:e,...t},r){return{...t,args:e.map(r)}}processResponseTicket(e,t){return e.status==="resolve"?{...e,value:t(e.value)}:e}subscribe(e,t){return this.emitter.on(e,t),()=>{this.emitter.off(e,t)}}subscribeOnce(e,t){let r=n=>{this.emitter.off(e,r),t(n)};return this.subscribe(e,r)}};function _t(e){return he(e)&&bt(_(e),"fnId")}var Ct=(e,t)=>{for(let r of t){let n=e[r];typeof n=="function"&&(e[r]=n.bind(e))}},ge=class{constructor(e,t){this.fnCounter=0,this.receiverTicketCache=new WeakMap,this.senderCache=new WeakMap,this.cleanupNotifier=t,this.subject=e,Ct(this,["makeSender","makeReceiver","simulate","materialize"])}static create(e,t){let r,n={simulate:i=>r.simulate(i),materialize:i=>r.materialize(i)},s=new Ot(e,n),o=new t(i=>s.notifyCleanup({fnId:i}));return r=new ge(s,o),r}makeReceiver(e,t){if(typeof e!="function")return U;let r=this.receiverTicketCache.get(e);if(!r){r={fnId:`${e.name||"<anonymous>"}_${++this.fnCounter}`};let n=e;t&&(n=e.bind(t));let s=fe(n,r,new WeakRef(this.subject));this.subject.onOutOfScope(r,s),this.receiverTicketCache.set(n,r)}return I(r)}makeSender(e){if(!_t(e))return U;let t=_(e);if(this.senderCache.has(t))return this.senderCache.get(t);{let r=Pt(t,new WeakRef(this.subject));return this.cleanupNotifier.register(r,t.fnId,r),this.senderCache.set(t,r),r}}materialize(e){return R(this.makeSender,e)}simulate(e){return R(this.makeReceiver,e)}};function pe(e,t,r,n){return new Promise((s,o)=>{let i=async c=>{try{n&&await n(c)}finally{o(c)}},a=setTimeout(()=>{i(new Error(`${typeof e=="function"?e():e} timed out after ${r}ms`))},r);t.then(c=>{clearTimeout(a),s(c)}).catch(c=>{clearTimeout(a),i(c)})})}var me={fnId:vt},ve=st(ot()),ee={"0.7.0":"0.8.0","0.8.0":"0.8.1"};function ye(e){let t=ee.hasOwnProperty(e)?ee[e]:e,[r,n="UNKNOWN",s="UNKNOWN"]=t.split("."),[o,i=""]=s.split("-");return{major:r,minor:n,patch:o,prerelease:i}}var F=ye(M),te=class{constructor(e){this.versionWarnings=new Set,this.myOrigin=e.myOrigin,this.remoteOrigin=e.targetOrigin==="*"?"remote document":e.targetOrigin,this.logger=e.logger}resetWarnings(){this.versionWarnings.clear()}makeAccepted(e){return I({accepts:e,version:M})}makeOffered(e){return I({offers:e,version:M})}isHandshakeAccepting(e,t){return this.isHandshake(e)&&_(e).accepts===t}isHandshakeOffer(e){return this.isHandshake(e)&&typeof _(e).offers=="string"}isCompatibleVersion(e){let t=ye(e);return t.major===F.major&&t.minor===F.minor&&t.prerelease===F.prerelease}isHandshake(e){if(!he(e))return this.logMalformed(e),!1;let t=_(e);if(!z(t)||typeof t.version!="string"||!(Reflect.has(t,"accepts")||Reflect.has(t,"offers")))return this.logMalformed(e),!1;let{version:r}=t;return!this.isCompatibleVersion(r)&&!this.versionWarnings.has(r)&&(this.versionWarnings.add(r),this.logger.warn(`SDK version mismatch. ${this.myOrigin} is using v${M}, but received message from ${this.remoteOrigin} using SDK v${r}. Extensions may be broken or unresponsive.`)),!0}logMalformed(e){let t;try{t=JSON.stringify(e,null,2)}catch{try{t=e.toString()}catch{t=Object.prototype.toString.call(e)}}this.logger.error(`Malformed tunnel message sent from SDK at ${this.remoteOrigin} to ${this.myOrigin}:
${t}
Message must be an object with "${C}" property, which must be an object with a "version" string and an either an "accepts" or "offers" property containing an ID string.`)}},$t=100,Rt=5e3,be=36,St=8,At=be**St,Mt=()=>Math.round(Math.random()*At).toString(be),It=`
 - timeout value must be a number of milliseconds`,jt=`
 - targetOrigin must be a valid URL origin or '*' for any origin`;function re(e,t,r){try{return t===e.source&&(r==="*"||r===new URL(e.origin).origin)}catch{return!1}}var{emit:kt}=ve.default.prototype,w=class extends ve.default{constructor(e){super(),this.emitLocal=(t,r)=>kt.call(this,t,r),this._emitFromMessage=({data:{type:t,payload:r}})=>{this.emitLocal(t,r)},this.config=e}static toIframe(e,t){if(!Et(e))throw new Error(`Provided tunnel target is not an iframe! ${Object.prototype.toString.call(e)}`);let r=w._normalizeConfig(t),n=new w(r),s=new te({myOrigin:window.location.origin,targetOrigin:r.targetOrigin,logger:r.logger});n.on("destroyed",()=>r.logger.log(`Tunnel to iframe at ${r.targetOrigin} destroyed!`,n,e)),n.on("connected",()=>r.logger.log(`Tunnel to iframe at ${r.targetOrigin} connected!`,n,e)),n.on("error",u=>r.logger.log(`Tunnel to iframe at ${r.targetOrigin} error!`,n,e,u));let o,i,a=u=>{if(!n.isConnected&&re(u,e.contentWindow,r.targetOrigin)&&s.isHandshakeOffer(u.data)){let l=s.makeAccepted(_(u.data).offers),d=new MessageChannel;e.contentWindow.postMessage(l,r.targetOrigin,[d.port1]),n.connect(d.port2)}},c=()=>{clearTimeout(i),clearInterval(o),window.removeEventListener("message",a)};return i=window.setTimeout(()=>{n.abort(new Error(`Timed out awaiting initial message from target iframe after ${r.timeout}ms`))},r.timeout),n.on("destroyed",c),n.on("connected",()=>clearTimeout(i)),o=window.setInterval(()=>{if(!e.isConnected)if(c(),n.isConnected){let u=new Error(`Tunnel target iframe at ${n.config.targetOrigin} was disconnected from the document!`);Object.assign(u,{target:e}),n.abort(u)}else n.destroy()},Rt),window.addEventListener("message",a),n}static toParent(e,t){let r,n,s=!1,o=Mt(),i=w._normalizeConfig(t),a=new w(i);a.on("destroyed",()=>i.logger.log(`Tunnel ${o} to parent window destroyed!`,a)),a.on("connected",()=>i.logger.log(`Tunnel ${o} to parent window connected!`,a)),a.on("error",h=>i.logger.log(`Tunnel ${o} to parent window error!`,a,h));let c=new te({myOrigin:window.location.origin,targetOrigin:i.targetOrigin,logger:i.logger}),u=h=>{if(!s&&re(h,e,i.targetOrigin)&&c.isHandshakeAccepting(h.data,o)){if(l(),!h.ports||!h.ports.length){let m=new Error("Received handshake accept message, but it did not include a MessagePort to establish tunnel");a.emitLocal("error",m);return}a.connect(h.ports[0])}},l=()=>{clearInterval(r),clearTimeout(n),window.removeEventListener("message",u)};n=window.setTimeout(()=>{s||(s=!0,a.abort(new Error(`Timed out waiting for initial response from parent after ${i.timeout}ms`)))},i.timeout),window.addEventListener("message",u),a.on("destroyed",()=>{l()}),a.on("connected",()=>{l()});let d=()=>{a.isConnected?clearInterval(r):e.postMessage(c.makeOffered(o),i.targetOrigin)};return r=window.setInterval(d,$t),d(),a}connect(e){this._messagePort&&(this._messagePort.removeEventListener("message",this._emitFromMessage),this._messagePort.close()),this._messagePort=e,e.addEventListener("message",this._emitFromMessage),this.emitLocal("connected"),this._messagePort.start(),this.isConnected=!0}abort(e){this.emitLocal("error",e),this.destroy(e)}destroy(e){this._messagePort&&(this._messagePort.close(),this._messagePort=null,this.isConnected=!1);let t=e?[e]:[];this.emitLocal("destroyed",...t)}emit(e,t){return this._messagePort?(this._messagePort.postMessage({type:e,payload:t}),!0):!1}static _normalizeConfig(e={}){let t="",r={timeout:4e3,...e,logger:e.logger||ue},n=Number(r.timeout);if(Number.isSafeInteger(n)||(t+=It),r.targetOrigin!=="*")try{new URL(r.targetOrigin)}catch{t+=jt}if(t)throw new Error(`Invalid tunnel configuration: ${t}`);return r}},Tt=I(me);async function Ee(e,t){let r=!1,n,s={tunnel:e,getRemoteApi(){return n}};return pe("Initial API exchange",new Promise((o,i)=>{let a=ge.create(e,FinalizationRegistry),c=a.makeSender(Tt),u=h=>{n=h,r||(r=!0,o(s))};e.on("api",u);let l=fe(h=>e.emitLocal("api",h),me,new WeakRef(a.subject)),d=h=>{l(),r||(r=!0,h&&i(h))};e.on("destroyed",d),e.on("connected",()=>c(t).catch(d))}),e.config.timeout,o=>{e.abort(o)})}async function Lt(e,t){let r=w.toParent(window.parent,e);return Ee(r,t)}async function Nt(e,t,r){let n=w.toIframe(e,t);return Ee(n,r)}function xe(e){try{return JSON.stringify(e,null,2)}catch{return de(e)?`Iterable<${e.length}>`:j(e)||yt(e)?`${e}`:Object.prototype.toString.call(e)}}function Dt(e){var t,r;let n=((t=e.path)==null?void 0:t.length)<1?"<Missing method path!>":e.path.join("."),s=e.name||"<Missing method name!>",o=(r=e.args)==null?void 0:r.map(xe).join(",");return`host.${n}.${s}(${o})`}function Ft(e){return new Promise(t=>{setTimeout(t,e)})}y.Emitter=mt;y.Tunnel=w;y._customConsole=ce;y.connectIframe=Nt;y.connectParentWindow=Lt;y.debugEmitter=pt;y.formatHostMethodAddress=Dt;y.formatHostMethodArgument=xe;y.makeNamespaceProxy=le;y.quietConsole=ue;y.timeoutPromise=pe;y.wait=Ft});var we=O(S=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0});S.getImpl=T;S.connect=Ut;function T(e){let t=window["exc-module-runtime"];if(!t)throw new Error(`module-runtime APIs not available (Fetching ${e}).`);return t[e]}function Ut(e,t){let r={};return t.forEach(n=>{let s=n[0];n[1]?r[s]=(...o)=>T(e)[s](...o):Object.defineProperty(r,s,{get:()=>T(e)[s],set:o=>{T(e)[s]=o}})}),r}S.default=window});var Oe=O(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.Events=void 0;var Pe;(function(e){e.PAGE_LOAD_DONE="exc.metrics.pageState.load.done",e.PAGE_LOAD_START="exc.metrics.pageState.load.start",e.SPINNER_DONE="exc.metrics.pageState.spinner.done",e.SPINNER_START="exc.metrics.pageState.spinner.start"})(Pe||(L.Events=Pe={}))});var Ce=O(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});N.Level=void 0;var _e;(function(e){e.ERROR="ERROR",e.WARN="WARN",e.INFO="INFO",e.DEBUG="DEBUG",e.TRACE="TRACE"})(_e||(N.Level=_e={}))});var $e=O(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});P.Level=P.Events=void 0;var Wt=we(),zt=Oe();Object.defineProperty(P,"Events",{enumerable:!0,get:function(){return zt.Events}});var Ht=Ce();Object.defineProperty(P,"Level",{enumerable:!0,get:function(){return Ht.Level}});var Gt=(0,Wt.connect)("metrics",[["create",!0]]);P.default=Gt});var ze=O((zr,We)=>{var Kt=Object.create,D=Object.defineProperty,Bt=Object.getOwnPropertyDescriptor,qt=Object.getOwnPropertyNames,Vt=Object.getPrototypeOf,Yt=Object.prototype.hasOwnProperty,Xt=(e,t)=>{for(var r in t)D(e,r,{get:t[r],enumerable:!0})},Ie=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of qt(t))!Yt.call(e,s)&&s!==r&&D(e,s,{get:()=>t[s],enumerable:!(n=Bt(t,s))||n.enumerable});return e},Jt=(e,t,r)=>(r=e!=null?Kt(Vt(e)):{},Ie(t||!e||!e.__esModule?D(r,"default",{value:e,enumerable:!0}):r,e)),Qt=e=>Ie(D({},"__esModule",{value:!0}),e),je={};Xt(je,{Host:()=>hr,Port:()=>De,combineExtensionsFromProviders:()=>yr,createExtensionRegistryAsObjectsProvider:()=>vr,createExtensionRegistryProvider:()=>mr,fetchExtensionsFromRegistry:()=>K,makeSandboxAttrs:()=>Zt,mergeAttrValues:()=>Te,mutedProvider:()=>br,normalizeIframe:()=>H,requiredIframeProps:()=>Le,tokenizeAttrValues:()=>ke});We.exports=Qt(je);var Re=k(),Se=k(),ke=e=>typeof e=="string"?e.split(" "):e,Te=(...e)=>{let t=new Set;for(let r of e)for(let n of ke(r))t.add(n);return[...t]},Zt=(...e)=>Te(...e),Le={"data-uix-guest":"true",role:"presentation",referrerPolicy:"strict-origin"},er=Object.entries(Le),H=e=>{for(let[t,r]of er)e.setAttribute(t,r)},tr={timeout:2e4,debug:!1},Ne="$_UISDK_FN_WRAPPER",rr=e=>typeof e=="function",nr=e=>typeof e=="function"&&e[Ne]===!0,De=class extends Se.Emitter{get apis(){if(this.isReady()&&this.guestServer){let e=this.guestServer.getRemoteApi();return e&&this.addApiMiddleware(e.apis)}}get metadata(){if(this.isReady()&&this.guestServer){let e=this.guestServer.getRemoteApi();return e&&e.metadata}}debug;logger;guestServerFrame;hostApis={};isLoaded=!1;runtimeContainer;sharedContext;configuration;subscriptions=[];timeout;error;url;extensionPoints;guestServer;constructor(e){super(e.id);let{timeout:t,debug:r}={...tr,...e.options||{}};this.timeout=t,this.debug=r,this.logger=e.logger,this.id=e.id,this.url=e.url,this.runtimeContainer=e.runtimeContainer,this.sharedContext=e.sharedContext,this.configuration=e.configuration,this.extensionPoints=e.extensionPoints,this.subscriptions.push(e.events.addEventListener("contextchange",async n=>{this.sharedContext=n.detail.context,await this.load(),await this.guestServer.getRemoteApi().emit("contextchange",{context:this.sharedContext})}))}attachUI(e,t){return this.attachFrame(e,{onIframeResize:r=>{this.emit("guestresize",{dimensions:r,guestPort:this,iframe:e})},...t})}hasCapabilities(e){return this.assertReady(),this.apis&&Object.entries(e).every(([t,r])=>this.hasCapability(t,r))}isReady(){return this.isLoaded&&!this.error}async load(){try{this.isLoaded||await this.connect()}catch(e){throw this.guestServer=null,this.error=e instanceof Error?e:new Error(String(e)),e}}provide(e){for(let[t,r]of Object.entries(e))this.hostApis[t]=this.hostApis[t]||{},Object.assign(this.hostApis[t],r);this.emit("hostprovide",{guestPort:this,apis:e})}async unload(){this.guestServerFrame&&this.guestServerFrame.parentElement&&(this.guestServerFrame.parentElement.removeChild(this.guestServerFrame),this.guestServerFrame=void 0),this.emit("unload",{guestPort:this})}addApiMiddleware(e,t=[]){if(typeof e=="object")for(let[r,n]of Object.entries(e))if(typeof n=="object")e[r]=this.addApiMiddleware(n,[...t,r]);else{if(nr(n))continue;if(rr(n)){let s=async(...o)=>{this.emit("beforecallguestmethod",{guestPort:this,path:[...t,r],args:o});let i=await n(...o);return this.addApiMiddleware(i,[...t,r])};s[Ne]=!0,e[r]=s}}return e}hasCapability(e,t){let r=this.apis[e];return r&&t.every(n=>Reflect.has(r,n)&&typeof r[n]=="function")}assert(e,t){if(!e)throw new Error(`Error in guest extension "${this.id}": ${t()}`)}assertReady(){this.assert(this.isReady(),()=>"Attempted to interact before loaded")}attachFrame(e,t={}){return H(e),this.logger.log("attachFrame",e),(0,Se.connectIframe)(e,{logger:this.logger,targetOrigin:this.url.origin,timeout:this.timeout},{getSharedContext:()=>this.sharedContext,getConfiguration:()=>this.configuration,invokeHostMethod:r=>this.invokeHostMethod(r,t),...t})}async connect(){let e=this.runtimeContainer.ownerDocument.createElement("iframe");H(e),e.setAttribute("aria-hidden","true"),e.setAttribute("src",this.url.href),this.guestServerFrame=e,this.runtimeContainer.appendChild(e),this.logger&&this.logger.info(`Guest ${this.id} attached iframe of ${this.url.href}`,this),this.guestServer=await this.attachFrame(e),this.isLoaded=!0,this.logger&&this.logger.info(`Guest ${this.id} established connection, received methods`,this.apis,this)}getHostMethodCallee({name:e,path:t},r){let n=o=>`host.${t.slice(0,o).join(".")}`,s=t.reduce((o,i,a)=>{this.assert(Reflect.has(o,i),()=>`${n(a)} has no property "${i}"`);let c=o[i];return this.assert(typeof c=="object",()=>`${n(a)}.${i} is not an object; namespaces must be objects with methods`),c},r);return this.assert(typeof s[e]=="function"&&Reflect.has(s,e),()=>`"${n(t.length-1)}.${e}" is not a function`),s}invokeHostMethod(e,t){let{name:r,path:n,args:s=[]}=e;this.assert(r&&typeof r=="string",()=>"Method name required"),this.assert(n.length>0,()=>`Cannot call a method directly on the host; ".${r}()" must be in a namespace.`);let o;if(t)try{o=this.getHostMethodCallee(e,t)}catch{}o||(o=this.getHostMethodCallee(e,this.hostApis));let i=o[r];return this.emit("beforecallhostmethod",{guestPort:this,name:r,path:n,args:s}),i.apply(o,[{id:this.id,url:this.url},...s])}},Ae=k();function sr(e){let t=(0,Ae.debugEmitter)(e,{theme:"blue medium",type:"Host"});return t.listen("guestbeforeload",(r,n)=>{let{detail:s}=n,o=s.guest;r.info(n,`Guest ID ${o.id}`),(0,Ae.debugEmitter)(o,{theme:"green medium",type:"Port",id:`${e.id} \u2794 ${o.id}`}).listen("hostprovide",(a,c)=>{a.info("received APIs",c.detail.apis)}).listen("beforecallhostmethod",(a,c)=>{a.info(c.detail)}).listen("guestresize",(a,c)=>{a.info(c.detail)}).listen("unload",(a,c)=>{a.info(c.detail),a.detach()}).listen("beforecallguestmethod",(a,c)=>{a.info(c.detail)})}).listen("guestload",(r,n)=>{r.info(n.detail.guest.id,n.detail.guest)}).listen("error",(r,n)=>{r.error(`Error: ${n.detail.error.message}`,n)}).listen("loadallguests",(r,{detail:{failed:n,loaded:s,host:o}})=>{n.length>0&&r.error("%d guests failed to load!",n.length),r.info("%d guests loaded",s.length,o)}).listen("unload",r=>{r.info("Unloaded guest and container."),r.detach()}),t}var or=Jt($e()),ir=class{eventPool=[];metricsInstance=void 0;flush(){this.metricsInstance&&(this.eventPool.forEach(e=>{this.metricsInstance.event(e.event,e.args)}),this.eventPool=[])}get mertricsInstance(){return this.metricsInstance}set mertricsInstance(e){this.metricsInstance=e,this.metricsInstance&&this.flush()}event(e,t){this.metricsInstance?this.metricsInstance.event(e,t):this.eventPool.push({event:e,args:t})}},A=new ir,Me=new Set,ar=1e4,cr=()=>or.default.create("exc.uix.core"),ur=Date.now(),Fe=()=>{if(!(ur+ar<Date.now())){if("exc-module-runtime"in window){A.mertricsInstance=cr();return}setTimeout(Fe,1e3)}};Fe();function lr(e){e.addEventListener("guestload",t=>{let r=t.detail.guest;if(Me.has(r))return;Me.add(r);let n=s=>(s.guestId=r.id,s);A.event("load",n({})),r.addEventListener("beforecallguestmethod",s=>{let{path:o}=s.detail;A.event("callguestmethod",n({path:o.join(".")}))}),r.addEventListener("beforecallhostmethod",s=>{let{path:o,name:i}=s.detail;o.push(i),A.event("callhostmethod",n({path:o.join(".")}))})}),e.addEventListener("error",()=>{A.event("error",{})})}var dr=()=>!0,hr=class Ue extends Re.Emitter{loadallguests;guestload;guestbeforeload;guestbeforeunload;guestunload;contextchange;error;static containerStyle={position:"fixed",width:"1px",height:"1px",pointerEvents:"none",opacity:0,top:0,left:"-1px"};hostName;loading=!1;guests=new Map;cachedCapabilityLists=new WeakMap;runtimeContainer;guestOptions;logger=Re.quietConsole;sharedContext;constructor(t){super(t.hostName);let{guestOptions:r={}}=t;this.guestOptions={...r,debug:r.debug===!1?!1:!!t.debug},this.hostName=t.hostName,this.sharedContext=t.sharedContext||{},this.runtimeContainer=t.runtimeContainer,t.debug&&(this.logger=sr(this)),t.disableMetrics||lr(this)}getLoadedGuests(t){if(typeof t=="object")return this.getLoadedGuestsWith(t);let r=t||dr,n=[];for(let s of this.guests.values())s.isReady()&&r(s)&&n.push(s);return n}shareContext(t){typeof t=="function"?this.sharedContext=t(this.sharedContext):this.sharedContext=t,this.emit("contextchange",{host:this,context:this.sharedContext})}async load(t,r){this.runtimeContainer=this.runtimeContainer||this.createRuntimeContainer(window);let n=[],s=[];this.loading=!0,await Promise.all(Object.entries(t).map(async([o,i])=>{let a=await this.loadOneGuest(o,i,r);(a.error?n:s).push(a)})),this.loading=!1,this.emit("loadallguests",{host:this,failed:n,loaded:s})}async unload(){this.emit("beforeunload",{host:this}),await Promise.all([...this.guests.values()].map(t=>t.unload())),this.guests.clear(),this.runtimeContainer.parentElement.removeChild(this.runtimeContainer),this.emit("unload",{host:this})}createRuntimeContainer(t){let{document:r}=t,n=r.createElement("div");return n.setAttribute("data-uix-guest-container",this.hostName),n.setAttribute("role","presentation"),n.setAttribute("aria-hidden","true"),Object.assign(n.style,Ue.containerStyle),r.body.appendChild(n),n}async loadOneGuest(t,r,n={}){let s=this.guests.get(t);if(!s){let i=(d=>typeof d=="object"&&d!==null&&"url"in d)(r),a=i?r.url:r,c=i?r.configuration:void 0,u=i?r.extensionPoints:[],l=new URL(a);s=new De({owner:this.hostName,id:t,url:l,runtimeContainer:this.runtimeContainer,options:{...this.guestOptions,...n},logger:this.logger,sharedContext:this.sharedContext,configuration:c,extensionPoints:u,events:this}),this.guests.set(t,s)}this.emit("guestbeforeload",{guest:s,host:this});try{await s.load()}catch(o){let i=new Error(`Guest ${s.id} failed to load: at ${s.url}: ${o instanceof Error?o.stack:String(o)}`);return this.emit("error",{host:this,guest:s,error:i}),s}return this.cachedCapabilityLists=new WeakMap,this.emit("guestload",{guest:s,host:this}),s}getLoadedGuestsWith(t){if(this.cachedCapabilityLists.has(t))return this.cachedCapabilityLists.get(t);let r=this.getLoadedGuests(n=>n.hasCapabilities(t));return this.cachedCapabilityLists.set(t,r),r}};function G(e){return`${e.service}/${e.extensionPoint}/${e.version}`}function fr(e){return e.startsWith("https://")||e.startsWith("http://")?e:`https://${e}`}async function K(e){let t=e.workspace?`&workspace=${e.workspace}`:"",r=await fetch(`${fr(e.baseUrl||"appregistry.adobe.io")}/myxchng/v1/org/${encodeURIComponent(e.imsOrg)}/xtn/${G(e)}?auth=true${t}`,{headers:{Accept:"application/json",Authorization:`${e.auth.schema} ${e.auth.imsToken}`,"X-Api-Key":e.apiKey}});if(r.status!=200)throw new Error(`extension registry returned non-200 response (${r.status}): ${await r.text()}`);return await r.json()}function gr(e){let t=G(e);return K(e).then(r=>r.reduce((n,s)=>s.status!=="PUBLISHED"?n:{...n,[s.name]:s.endpoints[t].view[0].href},{}))}function pr(e){let t=G(e);return K(e).then(r=>r.reduce((n,s)=>{if(e.filter&&typeof e.filter=="function"){if(!e.filter(s))return n}else if(s.status!=="PUBLISHED")return n;return{...n,[s.name]:{id:s.name,url:s.endpoints[t].view[0].href,extensionPoints:[t]}}},{}))}function mr(e){return function(){return gr(e)}}function vr(e){return function(){return pr(e)}}function yr(...e){return()=>Promise.all(e.map(t=>t())).then(t=>Object.assign({},...t))}function br(e){return async()=>{try{return await e()}catch(t){return console.error(`Extension provider has failed: ${t.message}`,{error:t}),{}}}}});var He=Je(ze()),Er="https://aemx-mngr.adobe.io",xr="https://aemx-mngr-stage.adobe.io",wr="https://appregistry.adobe.io",Pr="https://appregistry-stage.adobe.io",Or=(e,t)=>e==="prod"?wr:t??Pr,_r=(e,t)=>e==="prod"?Er:t??xr;function qr(e){let r=/p(\d+)-e(\d+)/.exec(e);if(!r)throw new Error("Error parsing a repo value");return{programId:r[1],envId:r[2]}}function Cr(e){let t=e.scope?Object.fromEntries(Object.entries(e.scope).map(([s,o])=>[`scope.${s}`,o])):{},r=`${e.service}/${e.extensionPoint}/${e.version}`,n=new URLSearchParams({...t,extensionPoints:r});return`${e.baseUrl}/v2/extensions?${n.toString()}`}async function $r(e){let t=await fetch(Cr(e),{headers:{Authorization:`Bearer ${e.auth.imsToken}`,"x-api-key":e.apiKey,"x-org-id":e.imsOrg}});if(t.status!==200)throw new Error(`Extension Manager returned non-200 response (${t.status}): ${await t.text()}`);return t.json()}function Rr(e,t,r){let n=Object.assign(e,{});return t.forEach(s=>{if(s.disabled)delete n[s.name];else{let o=s.extensionPoints.find(i=>i.extensionPoint===`${r.service}/${r.name}/${r.version}`);o?n[s.name]={id:s.name,url:o.url,configuration:s.configuration,extensionPoints:s.extensionPoints.map(i=>i.extensionPoint)}:console.warn(`Extension point ${r.service}/${r.name}/${r.version} not found for extension ${s.name}`)}}),n}async function Sr(e,t,r,n){let s={apiKey:t.apiKey,auth:{schema:"Bearer",imsToken:t.imsToken},service:n.service,extensionPoint:n.name,version:n.version,imsOrg:t.imsOrg,scope:e.scope},o={...s,baseUrl:Or(e.experienceShellEnvironment,r.appRegistryUrl)},i=(0,He.createExtensionRegistryAsObjectsProvider)(o),a={...s,baseUrl:_r(e.experienceShellEnvironment,r.extensionManagerUrl)},[c,u]=await Promise.all([i(),r.disableExtensionManager?[]:$r(a)]);return r.disableExtensionManager?c:Rr(c,u,n)}function Vr(e,t,r,n){return()=>Sr(e,t,r,n)}export{Cr as buildExtensionManagerUrl,Vr as createExtensionManagerExtensionsProvider,qr as extractProgramIdEnvId,$r as fetchExtensionsFromExtensionManager,_r as getExtensionManagerBaseUrl,Or as getExtensionRegistryBaseUrl,Rr as mergeExtensions};
