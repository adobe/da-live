var We=Object.create;var J=Object.defineProperty;var Ue=Object.getOwnPropertyDescriptor;var Ve=Object.getOwnPropertyNames;var ze=Object.getPrototypeOf,Ke=Object.prototype.hasOwnProperty;var A=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Be=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Ve(t))!Ke.call(e,s)&&s!==n&&J(e,s,{get:()=>t[s],enumerable:!(r=Ue(t,s))||r.enumerable});return e};var $=(e,t,n)=>(n=e!=null?We(ze(e)):{},Be(t||!e||!e.__esModule?J(n,"default",{value:e,enumerable:!0}):n,e));var L=A(y=>{"use strict";var qe=Object.create,ae=Object.defineProperty,Ye=Object.getOwnPropertyDescriptor,ce=Object.getOwnPropertyNames,Je=Object.getPrototypeOf,Xe=Object.prototype.hasOwnProperty,Qe=(e,t)=>function(){return t||(0,e[ce(e)[0]])((t={exports:{}}).exports,t),t.exports},Ze=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of ce(t))!Xe.call(e,s)&&s!==n&&ae(e,s,{get:()=>t[s],enumerable:!(r=Ye(t,s))||r.enumerable});return e},et=(e,t,n)=>(n=e!=null?qe(Je(e)):{},Ze(t||!e||!e.__esModule?ae(n,"default",{value:e,enumerable:!0}):n,e)),tt=Qe({"../../node_modules/eventemitter3/index.js"(e,t){var n=Object.prototype.hasOwnProperty,r="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(r=!1));function o(u,l,d){this.fn=u,this.context=l,this.once=d||!1}function i(u,l,d,p,g){if(typeof d!="function")throw new TypeError("The listener must be a function");var v=new o(d,p||u,g),f=r?r+l:l;return u._events[f]?u._events[f].fn?u._events[f]=[u._events[f],v]:u._events[f].push(v):(u._events[f]=v,u._eventsCount++),u}function a(u,l){--u._eventsCount===0?u._events=new s:delete u._events[l]}function c(){this._events=new s,this._eventsCount=0}c.prototype.eventNames=function(){var l=[],d,p;if(this._eventsCount===0)return l;for(p in d=this._events)n.call(d,p)&&l.push(r?p.slice(1):p);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(d)):l},c.prototype.listeners=function(l){var d=r?r+l:l,p=this._events[d];if(!p)return[];if(p.fn)return[p.fn];for(var g=0,v=p.length,f=new Array(v);g<v;g++)f[g]=p[g].fn;return f},c.prototype.listenerCount=function(l){var d=r?r+l:l,p=this._events[d];return p?p.fn?1:p.length:0},c.prototype.emit=function(l,d,p,g,v,f){var b=r?r+l:l;if(!this._events[b])return!1;var h=this._events[b],E=arguments.length,x,m;if(h.fn){switch(h.once&&this.removeListener(l,h.fn,void 0,!0),E){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,d),!0;case 3:return h.fn.call(h.context,d,p),!0;case 4:return h.fn.call(h.context,d,p,g),!0;case 5:return h.fn.call(h.context,d,p,g,v),!0;case 6:return h.fn.call(h.context,d,p,g,v,f),!0}for(m=1,x=new Array(E-1);m<E;m++)x[m-1]=arguments[m];h.fn.apply(h.context,x)}else{var Fe=h.length,R;for(m=0;m<Fe;m++)switch(h[m].once&&this.removeListener(l,h[m].fn,void 0,!0),E){case 1:h[m].fn.call(h[m].context);break;case 2:h[m].fn.call(h[m].context,d);break;case 3:h[m].fn.call(h[m].context,d,p);break;case 4:h[m].fn.call(h[m].context,d,p,g);break;default:if(!x)for(R=1,x=new Array(E-1);R<E;R++)x[R-1]=arguments[R];h[m].fn.apply(h[m].context,x)}}return!0},c.prototype.on=function(l,d,p){return i(this,l,d,p,!1)},c.prototype.once=function(l,d,p){return i(this,l,d,p,!0)},c.prototype.removeListener=function(l,d,p,g){var v=r?r+l:l;if(!this._events[v])return this;if(!d)return a(this,v),this;var f=this._events[v];if(f.fn)f.fn===d&&(!g||f.once)&&(!p||f.context===p)&&a(this,v);else{for(var b=0,h=[],E=f.length;b<E;b++)(f[b].fn!==d||g&&!f[b].once||p&&f[b].context!==p)&&h.push(f[b]);h.length?this._events[v]=h.length===1?h[0]:h:a(this,v)}return this},c.prototype.removeAllListeners=function(l){var d;return l?(d=r?r+l:l,this._events[d]&&a(this,d)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=r,c.EventEmitter=c,typeof t<"u"&&(t.exports=c)}}),nt=()=>typeof window.matchMedia=="function"&&window.matchMedia("(prefers-color-scheme: dark)").matches,rt={medium:{padX:5,padY:3,rounded:4,fontSize:100,emphasis:"font-weight: bold;"},small:{padX:3,padY:1,rounded:2,fontSize:95,emphasis:"font-style: italic;"}},st={yellow:{text:"#333333",bg:"#EBD932",hilight:"#F7E434",shadow:"#D1C12C"},green:{text:"#333333",bg:"#96EB5E",hilight:"#9EF763",shadow:"#85D154"},blue:{text:"#333333",bg:"#8DD0EB",hilight:"#88F0F7",shadow:"#74AED4"},gray:nt()?{text:"#eeeeee",bg:"transparent",hilight:"#cecece",shadow:"#cecece"}:{text:"#333333",bg:"#eeeeee",hilight:"#f6f6f6",shadow:"#cecece"}};function V(e){let t=new Map;return n=>{if(!t.has(n)){let r=e(n);return t.set(n,r),t.size>100&&t.delete(t.keys().next().value),r}return t.get(n)}}var ue=V(e=>{if(typeof e=="string"){let[t,n]=e.split(" ");return{...st[t],...rt[n]}}return e}),ot="display: inline-block; border: 1px solid;",X=e=>`padding-${e}: 0px; border-${e}-width: 0px; border-top-${e}-radius: 0px; border-bottom-${e}-radius: 0px;`,it=({bg:e,hilight:t,shadow:n,text:r})=>`color: ${r}; background: ${e}; border-color: ${t} ${n} ${n} ${t};`,at=({fontSize:e,padY:t,padX:n,rounded:r})=>`font-size: ${e}%; padding: ${t}px ${n}px; border-radius: ${r}px;`,ct=V(e=>{let t=`${ot}${it(e)}${at(e)}`;return[`${t}${X("right")}`,`${t}${X("left")}${e.emphasis}`]});function le(e,t,n){let r=`%c${e}%c ${t}`,[s,o]=ct(n);return i=>{let a=[r,s,o];return typeof i[0]=="string"&&(a[0]=`${r}%c ${i.shift()}`,a.push("")),[...a,...i]}}var Q={event:"\uFE0F\u26A1\uFE0F"},ut=" \u293B ",lt=V(e=>{let t=JSON.parse(e),n=t.shift(),r=Q[n.type],s=[n.name,...t.map(o=>`${Q[o.type]} ${o.name}`)].join(ut);return le(r,s,ue("gray small"))}),Z=e=>lt(JSON.stringify(e)),ee=["log","error","warn","info","debug"],te=e=>e,de=()=>{};function pe(e,t,n){let r=le(`X${t}`,n,ue(e)),s=te,o=[],i={detach:{writable:!0,configurable:!0,value(){ee.forEach(c=>{this[c]=de})}},pushState:{value(c){o.push(c),s=Z(o)}},popState:{value(){o.pop(),s=o.length===0?te:Z(o)}}};return Object.create(console,ee.reduce((c,u)=>(c[u]={writable:!0,configurable:!0,value(...l){console[u](...r(s(l)))}},c),i))}var he=new Proxy(console,{get(){return de}});function dt(e,t){let n=pe(t.theme,t.type||Object.getPrototypeOf(e).constructor.name,t.id||e.id),r=e.dispatchEvent;e.dispatchEvent=a=>{n.pushState({type:"event",name:a.type});let c=r.call(e,a);return n.popState(),c};let s=[],o=n.detach;n.detach=()=>{o.call(n),s.forEach(a=>a())};function i(a,c){return s.push(e.addEventListener(a,u=>c(n,u))),n}return n.listen=i,n}var pt=class extends EventTarget{constructor(e){super(),this.id=e}emit(e,t){let n=new CustomEvent(e,{detail:t});this.dispatchEvent(n)}addEventListener(e,t){return super.addEventListener(e,t),()=>super.removeEventListener(e,t)}};function fe(e,t=[]){let n={get:(o,i)=>{if(typeof i=="string"){if(!Reflect.has(o,i)){let a=fe(e,t.concat(i));Reflect.set(o,i,a)}return Reflect.get(o,i)}else throw new Error(`Cannot look up a symbol ${String(i)} on a host connection proxy.`)}},r={};if(t.length<2)return new Proxy(r,n);let s=(...o)=>e({path:t.slice(0,-1),name:t[t.length-1],args:o});return new Proxy(s,{...n,apply(o,i,a){return o(...a)}})}var O="_$pg",k="1.0.1",ht=`${O}_init_cb`;function z(e){if(!e||typeof e!="object")return!1;let t=Reflect.getPrototypeOf(e);return t===null||t===Object.prototype}function I(e){if(!e)return!0;let t=typeof e;return t==="string"||t==="number"||t==="boolean"}function me(e){return Array.isArray(e)}function ft(e){return typeof e=="function"}function mt(e,t){return!I(e)&&Reflect.has(e,t)}function gt(e){if(!e||I(e))return!1;let{nodeName:t}=e;return typeof t=="string"&&t.toLowerCase()==="iframe"}function vt(e){return!e||typeof e!="object"?!1:Reflect.getPrototypeOf(e)!==Object.prototype}function M(e){return{[O]:e}}function P(e){return e[O]}function ge(e){if(!z(e))return!1;let t=Object.keys(e),n=t.includes(O);return n&&t.length!=1?(console.error(`malformed tunnel message, should have one prop "${O}" at root`,e),!1):n}var U=Symbol.for("NOT_TRANSFORMED"),ne="[[Circular]]";function S(e,t,n,r=new WeakSet){if(I(t))return t;let s=e(t,n);if(s!==U)return s;if(me(t)){let o=[];for(let i of t)o.push(S(e,i,void 0,r));return o}if(z(t)){if(r.has(t))return ne;r.add(t);let o={};for(let i of Reflect.ownKeys(t))Reflect.set(o,i,S(e,Reflect.get(t,i),void 0,r));return o}if(vt(t)){if(r.has(t))return ne;r.add(t);let o=c=>{let u=new Set;do if(Reflect.getPrototypeOf(c)!==null)for(let l of Object.getOwnPropertyNames(c))l!=="constructor"&&u.add(l);while(c=Reflect.getPrototypeOf(c));return[...u]},i={},a=o(t);for(let c of a)Reflect.set(i,c,S(e,Reflect.get(t,c),t,r));return i}throw new Error(`Bad value! ${Object.prototype.toString.call(t)}`)}function ve(e,t,n){let r=async({fnId:s,callId:o,args:i})=>{try{let a=await e(...i);n.deref().respond({fnId:s,callId:o,value:a,status:"resolve"})}catch(a){n.deref().respond({fnId:s,callId:o,status:"reject",error:a})}};return n.deref().onCall(t,r)}var re=class extends Error{constructor(){super("Function belongs to a simulated remote object which has been disconnected! The tunnel may have been destroyed by page navigation or reload.")}};function yt(e,t,n,r,s){e.onRespond(t,o=>{n.delete(s),o.status==="resolve"?r(o.value):s(o.error)}),e.send(t)}function bt({fnId:e},t){let n=0,r=new Set,s=function(...a){return new Promise((c,u)=>{r.add(u);let l=++n,d={fnId:e,callId:l,args:a};return yt(t.deref(),d,r,c,u)})},o=()=>{t=null,s=()=>{throw new re};for(let a of r)a(new re);r.clear()};t.deref().onDestroyed(o);let i=async function(...a){return s(...a)};return Object.defineProperty(i,"name",{value:e}),i}var Et=class{constructor(e,t){this.emitter=e,this.simulator=t}notifyCleanup(e){return this.emitter.emit(`${e.fnId}_g`,{})}notifyConnect(){return this.emitter.emit("connected")}notifyDestroy(){return this.emitter.emit("destroyed")}onCall(e,t){return this.subscribe(`${e.fnId}_c`,n=>t(this.processCallTicket(n,this.simulator.materialize)))}onConnected(e){return this.subscribe("connected",e)}onDestroyed(e){return this.subscribe("destroyed",e)}onOutOfScope(e,t){return this.subscribeOnce(`${e.fnId}_g`,t)}onRespond(e,t){let n=`${e.fnId}${e.callId}`;return this.subscribeOnce(`${n}_r`,r=>t(this.processResponseTicket(r,this.simulator.materialize)))}respond(e){let t=`${e.fnId}${e.callId}`;return this.emitter.emit(`${t}_r`,this.processResponseTicket(e,this.simulator.simulate))}send(e){return this.emitter.emit(`${e.fnId}_c`,this.processCallTicket(e,this.simulator.simulate))}processCallTicket({args:e,...t},n){return{...t,args:e.map(n)}}processResponseTicket(e,t){return e.status==="resolve"?{...e,value:t(e.value)}:e}subscribe(e,t){return this.emitter.on(e,t),()=>{this.emitter.off(e,t)}}subscribeOnce(e,t){let n=r=>{this.emitter.off(e,n),t(r)};return this.subscribe(e,n)}};function xt(e){return ge(e)&&mt(P(e),"fnId")}var wt=(e,t)=>{for(let n of t){let r=e[n];typeof r=="function"&&(e[n]=r.bind(e))}},ye=class{constructor(e,t){this.fnCounter=0,this.receiverTicketCache=new WeakMap,this.senderCache=new WeakMap,this.cleanupNotifier=t,this.subject=e,wt(this,["makeSender","makeReceiver","simulate","materialize"])}static create(e,t){let n,r={simulate:i=>n.simulate(i),materialize:i=>n.materialize(i)},s=new Et(e,r),o=new t(i=>s.notifyCleanup({fnId:i}));return n=new ye(s,o),n}makeReceiver(e,t){if(typeof e!="function")return U;let n=this.receiverTicketCache.get(e);if(!n){n={fnId:`${e.name||"<anonymous>"}_${++this.fnCounter}`};let r=e;t&&(r=e.bind(t));let s=ve(r,n,new WeakRef(this.subject));this.subject.onOutOfScope(n,s),this.receiverTicketCache.set(r,n)}return M(n)}makeSender(e){if(!xt(e))return U;let t=P(e);if(this.senderCache.has(t))return this.senderCache.get(t);{let n=bt(t,new WeakRef(this.subject));return this.cleanupNotifier.register(n,t.fnId,n),this.senderCache.set(t,n),n}}materialize(e){return S(this.makeSender,e)}simulate(e){return S(this.makeReceiver,e)}};function be(e,t,n,r){return new Promise((s,o)=>{let i=async c=>{try{r&&await r(c)}finally{o(c)}},a=setTimeout(()=>{i(new Error(`${typeof e=="function"?e():e} timed out after ${n}ms`))},n);t.then(c=>{clearTimeout(a),s(c)}).catch(c=>{clearTimeout(a),i(c)})})}var Ee={fnId:ht},xe=et(tt()),se={"0.7.0":"0.8.0","0.8.0":"0.8.1"};function we(e){let t=se.hasOwnProperty(e)?se[e]:e,[n,r="UNKNOWN",s="UNKNOWN"]=t.split("."),[o,i=""]=s.split("-");return{major:n,minor:r,patch:o,prerelease:i}}var W=we(k),oe=class{constructor(e){this.versionWarnings=new Set,this.myOrigin=e.myOrigin,this.remoteOrigin=e.targetOrigin==="*"?"remote document":e.targetOrigin,this.logger=e.logger}resetWarnings(){this.versionWarnings.clear()}makeAccepted(e){return M({accepts:e,version:k})}makeOffered(e){return M({offers:e,version:k})}isHandshakeAccepting(e,t){return this.isHandshake(e)&&P(e).accepts===t}isHandshakeOffer(e){return this.isHandshake(e)&&typeof P(e).offers=="string"}isCompatibleVersion(e){let t=we(e);return t.major===W.major&&t.minor===W.minor&&t.prerelease===W.prerelease}isHandshake(e){if(!ge(e))return this.logMalformed(e),!1;let t=P(e);if(!z(t)||typeof t.version!="string"||!(Reflect.has(t,"accepts")||Reflect.has(t,"offers")))return this.logMalformed(e),!1;let{version:n}=t;return!this.isCompatibleVersion(n)&&!this.versionWarnings.has(n)&&(this.versionWarnings.add(n),this.logger.warn(`SDK version mismatch. ${this.myOrigin} is using v${k}, but received message from ${this.remoteOrigin} using SDK v${n}. Extensions may be broken or unresponsive.`)),!0}logMalformed(e){let t;try{t=JSON.stringify(e,null,2)}catch{try{t=e.toString()}catch{t=Object.prototype.toString.call(e)}}this.logger.error(`Malformed tunnel message sent from SDK at ${this.remoteOrigin} to ${this.myOrigin}:
${t}
Message must be an object with "${O}" property, which must be an object with a "version" string and an either an "accepts" or "offers" property containing an ID string.`)}},Ct=100,Pt=5e3,Ce=36,Ot=8,Rt=Ce**Ot,At=()=>Math.round(Math.random()*Rt).toString(Ce),St=`
 - timeout value must be a number of milliseconds`,_t=`
 - targetOrigin must be a valid URL origin or '*' for any origin`;function ie(e,t,n){try{return t===e.source&&(n==="*"||n===new URL(e.origin).origin)}catch{return!1}}var{emit:Tt}=xe.default.prototype,w=class extends xe.default{constructor(e){super(),this.emitLocal=(t,n)=>Tt.call(this,t,n),this._emitFromMessage=({data:{type:t,payload:n}})=>{this.emitLocal(t,n)},this.config=e}static toIframe(e,t){if(!gt(e))throw new Error(`Provided tunnel target is not an iframe! ${Object.prototype.toString.call(e)}`);let n=w._normalizeConfig(t),r=new w(n),s=new oe({myOrigin:window.location.origin,targetOrigin:n.targetOrigin,logger:n.logger});r.on("destroyed",()=>n.logger.log(`Tunnel to iframe at ${n.targetOrigin} destroyed!`,r,e)),r.on("connected",()=>n.logger.log(`Tunnel to iframe at ${n.targetOrigin} connected!`,r,e)),r.on("error",u=>n.logger.log(`Tunnel to iframe at ${n.targetOrigin} error!`,r,e,u));let o,i,a=u=>{if(!r.isConnected&&ie(u,e.contentWindow,n.targetOrigin)&&s.isHandshakeOffer(u.data)){let l=s.makeAccepted(P(u.data).offers),d=new MessageChannel;e.contentWindow.postMessage(l,n.targetOrigin,[d.port1]),r.connect(d.port2)}},c=()=>{clearTimeout(i),clearInterval(o),window.removeEventListener("message",a)};return i=window.setTimeout(()=>{r.abort(new Error(`Timed out awaiting initial message from target iframe after ${n.timeout}ms`))},n.timeout),r.on("destroyed",c),r.on("connected",()=>clearTimeout(i)),o=window.setInterval(()=>{if(!e.isConnected)if(c(),r.isConnected){let u=new Error(`Tunnel target iframe at ${r.config.targetOrigin} was disconnected from the document!`);Object.assign(u,{target:e}),r.abort(u)}else r.destroy()},Pt),window.addEventListener("message",a),r}static toParent(e,t){let n,r,s=!1,o=At(),i=w._normalizeConfig(t),a=new w(i);a.on("destroyed",()=>i.logger.log(`Tunnel ${o} to parent window destroyed!`,a)),a.on("connected",()=>i.logger.log(`Tunnel ${o} to parent window connected!`,a)),a.on("error",p=>i.logger.log(`Tunnel ${o} to parent window error!`,a,p));let c=new oe({myOrigin:window.location.origin,targetOrigin:i.targetOrigin,logger:i.logger}),u=p=>{if(!s&&ie(p,e,i.targetOrigin)&&c.isHandshakeAccepting(p.data,o)){if(l(),!p.ports||!p.ports.length){let g=new Error("Received handshake accept message, but it did not include a MessagePort to establish tunnel");a.emitLocal("error",g);return}a.connect(p.ports[0])}},l=()=>{clearInterval(n),clearTimeout(r),window.removeEventListener("message",u)};r=window.setTimeout(()=>{s||(s=!0,a.abort(new Error(`Timed out waiting for initial response from parent after ${i.timeout}ms`)))},i.timeout),window.addEventListener("message",u),a.on("destroyed",()=>{l()}),a.on("connected",()=>{l()});let d=()=>{a.isConnected?clearInterval(n):e.postMessage(c.makeOffered(o),i.targetOrigin)};return n=window.setInterval(d,Ct),d(),a}connect(e){this._messagePort&&(this._messagePort.removeEventListener("message",this._emitFromMessage),this._messagePort.close()),this._messagePort=e,e.addEventListener("message",this._emitFromMessage),this.emitLocal("connected"),this._messagePort.start(),this.isConnected=!0}abort(e){this.emitLocal("error",e),this.destroy(e)}destroy(e){this._messagePort&&(this._messagePort.close(),this._messagePort=null,this.isConnected=!1);let t=e?[e]:[];this.emitLocal("destroyed",...t)}emit(e,t){return this._messagePort?(this._messagePort.postMessage({type:e,payload:t}),!0):!1}static _normalizeConfig(e={}){let t="",n={timeout:4e3,...e,logger:e.logger||he},r=Number(n.timeout);if(Number.isSafeInteger(r)||(t+=St),n.targetOrigin!=="*")try{new URL(n.targetOrigin)}catch{t+=_t}if(t)throw new Error(`Invalid tunnel configuration: ${t}`);return n}},$t=M(Ee);async function Pe(e,t){let n=!1,r,s={tunnel:e,getRemoteApi(){return r}};return be("Initial API exchange",new Promise((o,i)=>{let a=ye.create(e,FinalizationRegistry),c=a.makeSender($t),u=p=>{r=p,n||(n=!0,o(s))};e.on("api",u);let l=ve(p=>e.emitLocal("api",p),Ee,new WeakRef(a.subject)),d=p=>{l(),n||(n=!0,p&&i(p))};e.on("destroyed",d),e.on("connected",()=>c(t).catch(d))}),e.config.timeout,o=>{e.abort(o)})}async function kt(e,t){let n=w.toParent(window.parent,e);return Pe(n,t)}async function Mt(e,t,n){let r=w.toIframe(e,t);return Pe(r,n)}function Oe(e){try{return JSON.stringify(e,null,2)}catch{return me(e)?`Iterable<${e.length}>`:I(e)||ft(e)?`${e}`:Object.prototype.toString.call(e)}}function It(e){var t,n;let r=((t=e.path)==null?void 0:t.length)<1?"<Missing method path!>":e.path.join("."),s=e.name||"<Missing method name!>",o=(n=e.args)==null?void 0:n.map(Oe).join(",");return`host.${r}.${s}(${o})`}function Lt(e){return new Promise(t=>{setTimeout(t,e)})}y.Emitter=pt;y.Tunnel=w;y._customConsole=pe;y.connectIframe=Mt;y.connectParentWindow=kt;y.debugEmitter=dt;y.formatHostMethodAddress=It;y.formatHostMethodArgument=Oe;y.makeNamespaceProxy=fe;y.quietConsole=he;y.timeoutPromise=be;y.wait=Lt});var _e=A(_=>{"use strict";Object.defineProperty(_,"__esModule",{value:!0});_.getImpl=G;_.connect=Wt;function G(e){let t=window["exc-module-runtime"];if(!t)throw new Error(`module-runtime APIs not available (Fetching ${e}).`);return t[e]}function Wt(e,t){let n={};return t.forEach(r=>{let s=r[0];r[1]?n[s]=(...o)=>G(e)[s](...o):Object.defineProperty(n,s,{get:()=>G(e)[s],set:o=>{G(e)[s]=o}})}),n}_.default=window});var $e=A(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});N.Events=void 0;var Te;(function(e){e.PAGE_LOAD_DONE="exc.metrics.pageState.load.done",e.PAGE_LOAD_START="exc.metrics.pageState.load.start",e.SPINNER_DONE="exc.metrics.pageState.spinner.done",e.SPINNER_START="exc.metrics.pageState.spinner.start"})(Te||(N.Events=Te={}))});var Me=A(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});D.Level=void 0;var ke;(function(e){e.ERROR="ERROR",e.WARN="WARN",e.INFO="INFO",e.DEBUG="DEBUG",e.TRACE="TRACE"})(ke||(D.Level=ke={}))});var Ie=A(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});C.Level=C.Events=void 0;var Ut=_e(),Vt=$e();Object.defineProperty(C,"Events",{enumerable:!0,get:function(){return Vt.Events}});var zt=Me();Object.defineProperty(C,"Level",{enumerable:!0,get:function(){return zt.Level}});var Kt=(0,Ut.connect)("metrics",[["create",!0]]);C.default=Kt});var F=$(L());var j=$(L());var Ht=e=>typeof e=="string"?e.split(" "):e,Re=(...e)=>{let t=new Set;for(let n of e)for(let r of Ht(n))t.add(r);return[...t]};var pn=(...e)=>Re(...e),jt={"data-uix-guest":"true",role:"presentation",referrerPolicy:"strict-origin"},Gt=Object.entries(jt),K=e=>{for(let[t,n]of Gt)e.setAttribute(t,n)};var Nt={timeout:2e4,debug:!1},Ae="$_UISDK_FN_WRAPPER",Dt=e=>typeof e=="function",Ft=e=>typeof e=="function"&&e[Ae]===!0,H=class extends j.Emitter{get apis(){if(this.isReady()&&this.guestServer){let t=this.guestServer.getRemoteApi();return t&&this.addApiMiddleware(t.apis)}}get metadata(){if(this.isReady()&&this.guestServer){let t=this.guestServer.getRemoteApi();return t&&t.metadata}}debug;logger;guestServerFrame;hostApis={};isLoaded=!1;runtimeContainer;sharedContext;configuration;subscriptions=[];timeout;error;url;extensionPoints;guestServer;constructor(t){super(t.id);let{timeout:n,debug:r}={...Nt,...t.options||{}};this.timeout=n,this.debug=r,this.logger=t.logger,this.id=t.id,this.url=t.url,this.runtimeContainer=t.runtimeContainer,this.sharedContext=t.sharedContext,this.configuration=t.configuration,this.extensionPoints=t.extensionPoints,this.subscriptions.push(t.events.addEventListener("contextchange",async s=>{this.sharedContext=s.detail.context,await this.load(),await this.guestServer.getRemoteApi().emit("contextchange",{context:this.sharedContext})}))}attachUI(t,n){return this.attachFrame(t,{onIframeResize:r=>{this.emit("guestresize",{dimensions:r,guestPort:this,iframe:t})},...n})}hasCapabilities(t){return this.assertReady(),this.apis&&Object.entries(t).every(([n,r])=>this.hasCapability(n,r))}isReady(){return this.isLoaded&&!this.error}async load(){try{this.isLoaded||await this.connect()}catch(t){throw this.guestServer=null,this.error=t instanceof Error?t:new Error(String(t)),t}}provide(t){for(let[n,r]of Object.entries(t))this.hostApis[n]=this.hostApis[n]||{},Object.assign(this.hostApis[n],r);this.emit("hostprovide",{guestPort:this,apis:t})}async unload(){this.guestServerFrame&&this.guestServerFrame.parentElement&&(this.guestServerFrame.parentElement.removeChild(this.guestServerFrame),this.guestServerFrame=void 0),this.emit("unload",{guestPort:this})}addApiMiddleware(t,n=[]){if(typeof t=="object")for(let[r,s]of Object.entries(t))if(typeof s=="object")t[r]=this.addApiMiddleware(s,[...n,r]);else{if(Ft(s))continue;if(Dt(s)){let o=async(...i)=>{this.emit("beforecallguestmethod",{guestPort:this,path:[...n,r],args:i});let a=await s(...i);return this.addApiMiddleware(a,[...n,r])};o[Ae]=!0,t[r]=o}}return t}hasCapability(t,n){let r=this.apis[t];return r&&n.every(s=>Reflect.has(r,s)&&typeof r[s]=="function")}assert(t,n){if(!t)throw new Error(`Error in guest extension "${this.id}": ${n()}`)}assertReady(){this.assert(this.isReady(),()=>"Attempted to interact before loaded")}attachFrame(t,n={}){return K(t),this.logger.log("attachFrame",t),(0,j.connectIframe)(t,{logger:this.logger,targetOrigin:this.url.origin,timeout:this.timeout},{getSharedContext:()=>this.sharedContext,getConfiguration:()=>this.configuration,invokeHostMethod:r=>this.invokeHostMethod(r,n),...n})}async connect(){let t=this.runtimeContainer.ownerDocument.createElement("iframe");K(t),t.setAttribute("aria-hidden","true"),t.setAttribute("src",this.url.href),this.guestServerFrame=t,this.runtimeContainer.appendChild(t),this.logger&&this.logger.info(`Guest ${this.id} attached iframe of ${this.url.href}`,this),this.guestServer=await this.attachFrame(t),this.isLoaded=!0,this.logger&&this.logger.info(`Guest ${this.id} established connection, received methods`,this.apis,this)}getHostMethodCallee({name:t,path:n},r){let s=i=>`host.${n.slice(0,i).join(".")}`,o=n.reduce((i,a,c)=>{this.assert(Reflect.has(i,a),()=>`${s(c)} has no property "${a}"`);let u=i[a];return this.assert(typeof u=="object",()=>`${s(c)}.${a} is not an object; namespaces must be objects with methods`),u},r);return this.assert(typeof o[t]=="function"&&Reflect.has(o,t),()=>`"${s(n.length-1)}.${t}" is not a function`),o}invokeHostMethod(t,n){let{name:r,path:s,args:o=[]}=t;this.assert(r&&typeof r=="string",()=>"Method name required"),this.assert(s.length>0,()=>`Cannot call a method directly on the host; ".${r}()" must be in a namespace.`);let i;if(n)try{i=this.getHostMethodCallee(t,n)}catch{}i||(i=this.getHostMethodCallee(t,this.hostApis));let a=i[r];return this.emit("beforecallhostmethod",{guestPort:this,name:r,path:s,args:o}),a.apply(i,[{id:this.id,url:this.url},...o])}};var B=$(L());function Se(e){let t=(0,B.debugEmitter)(e,{theme:"blue medium",type:"Host"});return t.listen("guestbeforeload",(n,r)=>{let{detail:s}=r,o=s.guest;n.info(r,`Guest ID ${o.id}`),(0,B.debugEmitter)(o,{theme:"green medium",type:"Port",id:`${e.id} \u2794 ${o.id}`}).listen("hostprovide",(a,c)=>{a.info("received APIs",c.detail.apis)}).listen("beforecallhostmethod",(a,c)=>{a.info(c.detail)}).listen("guestresize",(a,c)=>{a.info(c.detail)}).listen("unload",(a,c)=>{a.info(c.detail),a.detach()}).listen("beforecallguestmethod",(a,c)=>{a.info(c.detail)})}).listen("guestload",(n,r)=>{n.info(r.detail.guest.id,r.detail.guest)}).listen("error",(n,r)=>{n.error(`Error: ${r.detail.error.message}`,r)}).listen("loadallguests",(n,{detail:{failed:r,loaded:s,host:o}})=>{r.length>0&&n.error("%d guests failed to load!",r.length),n.info("%d guests loaded",s.length,o)}).listen("unload",n=>{n.info("Unloaded guest and container."),n.detach()}),t}var He=$(Ie()),q=class{eventPool=[];metricsInstance=void 0;flush(){this.metricsInstance&&(this.eventPool.forEach(t=>{this.metricsInstance.event(t.event,t.args)}),this.eventPool=[])}get mertricsInstance(){return this.metricsInstance}set mertricsInstance(t){this.metricsInstance=t,this.metricsInstance&&this.flush()}event(t,n){this.metricsInstance?this.metricsInstance.event(t,n):this.eventPool.push({event:t,args:n})}},T=new q,Le=new Set,Bt=1e4,qt=()=>He.default.create("exc.uix.core"),Yt=Date.now(),je=()=>{if(!(Yt+Bt<Date.now())){if("exc-module-runtime"in window){T.mertricsInstance=qt();return}setTimeout(je,1e3)}};je();function Ge(e){e.addEventListener("guestload",t=>{let n=t.detail.guest;if(Le.has(n))return;Le.add(n);let r=s=>(s.guestId=n.id,s);T.event("load",r({})),n.addEventListener("beforecallguestmethod",s=>{let{path:o}=s.detail;T.event("callguestmethod",r({path:o.join(".")}))}),n.addEventListener("beforecallhostmethod",s=>{let{path:o,name:i}=s.detail;o.push(i),T.event("callhostmethod",r({path:o.join(".")}))})}),e.addEventListener("error",()=>{T.event("error",{})})}var Jt=()=>!0,Ne=class e extends F.Emitter{loadallguests;guestload;guestbeforeload;guestbeforeunload;guestunload;contextchange;error;static containerStyle={position:"fixed",width:"1px",height:"1px",pointerEvents:"none",opacity:0,top:0,left:"-1px"};hostName;loading=!1;guests=new Map;cachedCapabilityLists=new WeakMap;runtimeContainer;guestOptions;logger=F.quietConsole;sharedContext;constructor(t){super(t.hostName);let{guestOptions:n={}}=t;this.guestOptions={...n,debug:n.debug===!1?!1:!!t.debug},this.hostName=t.hostName,this.sharedContext=t.sharedContext||{},this.runtimeContainer=t.runtimeContainer,t.debug&&(this.logger=Se(this)),t.disableMetrics||Ge(this)}getLoadedGuests(t){if(typeof t=="object")return this.getLoadedGuestsWith(t);let n=t||Jt,r=[];for(let s of this.guests.values())s.isReady()&&n(s)&&r.push(s);return r}shareContext(t){typeof t=="function"?this.sharedContext=t(this.sharedContext):this.sharedContext=t,this.emit("contextchange",{host:this,context:this.sharedContext})}async load(t,n){this.runtimeContainer=this.runtimeContainer||this.createRuntimeContainer(window);let r=[],s=[];this.loading=!0,await Promise.all(Object.entries(t).map(async([o,i])=>{let a=await this.loadOneGuest(o,i,n);(a.error?r:s).push(a)})),this.loading=!1,this.emit("loadallguests",{host:this,failed:r,loaded:s})}async unload(){this.emit("beforeunload",{host:this}),await Promise.all([...this.guests.values()].map(t=>t.unload())),this.guests.clear(),this.runtimeContainer.parentElement.removeChild(this.runtimeContainer),this.emit("unload",{host:this})}createRuntimeContainer(t){let{document:n}=t,r=n.createElement("div");return r.setAttribute("data-uix-guest-container",this.hostName),r.setAttribute("role","presentation"),r.setAttribute("aria-hidden","true"),Object.assign(r.style,e.containerStyle),n.body.appendChild(r),r}async loadOneGuest(t,n,r={}){let s=this.guests.get(t);if(!s){let i=(d=>typeof d=="object"&&d!==null&&"url"in d)(n),a=i?n.url:n,c=i?n.configuration:void 0,u=i?n.extensionPoints:[],l=new URL(a);s=new H({owner:this.hostName,id:t,url:l,runtimeContainer:this.runtimeContainer,options:{...this.guestOptions,...r},logger:this.logger,sharedContext:this.sharedContext,configuration:c,extensionPoints:u,events:this}),this.guests.set(t,s)}this.emit("guestbeforeload",{guest:s,host:this});try{await s.load()}catch(o){let i=new Error(`Guest ${s.id} failed to load: at ${s.url}: ${o instanceof Error?o.stack:String(o)}`);return this.emit("error",{host:this,guest:s,error:i}),s}return this.cachedCapabilityLists=new WeakMap,this.emit("guestload",{guest:s,host:this}),s}getLoadedGuestsWith(t){if(this.cachedCapabilityLists.has(t))return this.cachedCapabilityLists.get(t);let n=this.getLoadedGuests(r=>r.hasCapabilities(t));return this.cachedCapabilityLists.set(t,n),n}};function Y(e){return`${e.service}/${e.extensionPoint}/${e.version}`}function Xt(e){return e.startsWith("https://")||e.startsWith("http://")?e:`https://${e}`}async function De(e){let t=e.workspace?`&workspace=${e.workspace}`:"",n=await fetch(`${Xt(e.baseUrl||"appregistry.adobe.io")}/myxchng/v1/org/${encodeURIComponent(e.imsOrg)}/xtn/${Y(e)}?auth=true${t}`,{headers:{Accept:"application/json",Authorization:`${e.auth.schema} ${e.auth.imsToken}`,"X-Api-Key":e.apiKey}});if(n.status!=200)throw new Error(`extension registry returned non-200 response (${n.status}): ${await n.text()}`);return await n.json()}function Qt(e){let t=Y(e);return De(e).then(n=>n.reduce((r,s)=>s.status!=="PUBLISHED"?r:{...r,[s.name]:s.endpoints[t].view[0].href},{}))}function Zt(e){let t=Y(e);return De(e).then(n=>n.reduce((r,s)=>{if(e.filter&&typeof e.filter=="function"){if(!e.filter(s))return r}else if(s.status!=="PUBLISHED")return r;return{...r,[s.name]:{id:s.name,url:s.endpoints[t].view[0].href,extensionPoints:[t]}}},{}))}function Tn(e){return function(){return Qt(e)}}function $n(e){return function(){return Zt(e)}}function Mn(...e){return()=>Promise.all(e.map(t=>t())).then(t=>Object.assign({},...t))}function Ln(e){return async()=>{try{return await e()}catch(t){return console.error(`Extension provider has failed: ${t.message}`,{error:t}),{}}}}export{Ne as Host,H as Port,Mn as combineExtensionsFromProviders,$n as createExtensionRegistryAsObjectsProvider,Tn as createExtensionRegistryProvider,De as fetchExtensionsFromRegistry,pn as makeSandboxAttrs,Re as mergeAttrValues,Ln as mutedProvider,K as normalizeIframe,jt as requiredIframeProps,Ht as tokenizeAttrValues};
